import{q as D,S as h,_ as w,o as d,c,a as t,t as u,y as p,I as r,C as y,z as x,D as E,E as k,m as V,r as f,b as C,F as M,s as A}from"./index-CU5lGkkf.js";import{c as b}from"./couponsStore-lYH57srr.js";import{t as P}from"./timestampToDate-lwWXufjj.js";import{M as L,P as U}from"./Pagination-1lXEQ2Nu.js";var S={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:v,VITE_APP_PATH:g}=S,B={props:{currentCoupon:Object,isNew:Boolean},data(){return{couponModal:null,tempCoupon:{},inputDisabled:!0,startDateTimestamp:null,dueDateTimestamp:null}},created(){this.tempCoupon={...this.currentCoupon}},watch:{currentCoupon:{deep:!0,handler(l){this.tempCoupon=l}}},mounted(){this.couponModal=new L(document.querySelector("#couponModal"),{keyboard:!1,backdrop:"static"})},methods:{...D(b,["getCoupons"]),formatDate(l){const{formattedDate:e}=P(l);return{formattedDate:e}},validateDateInput(){const l=Math.floor(Date.parse(this.tempCoupon.start_date)/1e3),e=Math.floor(Date.parse(this.tempCoupon.due_date)/1e3);l>e&&h.fire({title:"啟用日不可大於截止日",icon:"info",showConfirmButton:!1,timer:1500}),this.startDateTimestamp=l,this.dueDateTimestamp=e},togglerEdit(){this.inputDisabled=!1},cancelUpdate(){this.inputDisabled=!0},updateCoupon(){let l=`${v}/api/${g}/admin/coupon`,e="post";this.isNew||(l=`${v}/api/${g}/admin/coupon/${this.tempCoupon.id}`,e="put"),this.tempCoupon.start_date=this.startDateTimestamp,this.tempCoupon.due_date=this.dueDateTimestamp;const _=this.tempCoupon.is_enabled?1:0;this.axios[e](l,{data:{...this.tempCoupon,is_enabled:_,percent:parseInt(this.tempCoupon.percent,10)}}).then(m=>{h.fire({title:m.data.message,icon:"success",showConfirmButton:!1,timer:1500}),this.getCoupons()}).then(()=>{this.inputDisabled=!0,this.couponModal.hide()}).catch(m=>{h.fire({title:m,icon:"error",confirmButtonText:"OK"})})}}},a=l=>(E("data-v-7034c0d9"),l=l(),k(),l),N={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-lg modal-dialog-centered"},O={class:"modal-content"},j={class:"modal-header bg-dark opacity-75 text-white"},H={class:"modal-title",id:"couponModalLabel"},z=a(()=>t("br",null,null,-1)),q=a(()=>t("i",{class:"bi bi-x-lg"},null,-1)),F=[q],X={class:"modal-body"},K={class:"container-fluid"},G={class:"row mb-5"},J={class:"border rounded p-2 bg-light"},Q={key:0,class:"row mb-2"},W={class:"col-md-6 d-flex align-items-center gap-3"},Y=a(()=>t("label",{for:"dateInput",class:"col-form-label"},"啟用日期：",-1)),Z={class:"col-sm-6"},$={class:"row mb-2"},tt={class:"col-md-6 d-flex align-items-center gap-3"},et=a(()=>t("label",{for:"enabled",class:"col-form-label"},"啟用狀態：",-1)),ot={class:"col-sm-6"},st=["disabled"],lt=a(()=>t("option",{value:!0}," 已啟用 ",-1)),nt=a(()=>t("option",{value:!1}," 未啟用 ",-1)),at=[lt,nt],it={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},dt={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},ct={class:"col-md-6"},pt={class:"row"},ut={class:"col-md-6"},rt=a(()=>t("h5",null,"優惠卷資訊",-1)),_t={class:"row mb-2"},mt=a(()=>t("label",{for:"title",class:"col-sm-4 col-form-label"},"優惠卷標題：",-1)),ht={class:"col-sm-8"},bt=["disabled"],ft={class:"row mb-2"},Ct=a(()=>t("label",{for:"code",class:"col-sm-4 col-form-label"},"優惠卷碼：",-1)),vt={class:"col-sm-8"},gt=["disabled"],Dt={class:"row mb-2"},wt=a(()=>t("label",{for:"percent",class:"col-sm-4 col-form-label"},"折扣百分比：",-1)),yt={class:"col-sm-8"},Pt=["disabled"],It={class:"col-md-6"},Tt=a(()=>t("h5",null,"修改期限",-1)),xt={class:"row mb-2"},Et=a(()=>t("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"啟用日期：",-1)),kt={class:"col-sm-8"},Vt=["disabled"],Mt={class:"row mb-2"},At=a(()=>t("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"截止日期：",-1)),Lt={class:"col-sm-8"},Ut=["disabled"],St={class:"modal-footer"};function Bt(l,e,_,m,o,n){return d(),c("div",N,[t("div",R,[t("div",O,[t("div",j,[t("h5",H,[t("span",null,"優惠卷ID："+u(o.tempCoupon.id),1),z]),t("button",{onClick:e[0]||(e[0]=(...s)=>n.cancelUpdate&&n.cancelUpdate(...s)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},F)]),t("div",X,[t("div",K,[t("div",G,[t("div",J,[isNaN(o.tempCoupon.start_date)?y("",!0):(d(),c("div",Q,[t("div",W,[Y,t("div",Z,[p(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.formatDate(o.tempCoupon.start_date).formattedDate=s),disabled:"",class:"form-control",type:"text",id:"dateInput"},null,512),[[r,n.formatDate(o.tempCoupon.start_date).formattedDate]])])])])),t("div",$,[t("div",tt,[et,t("div",ot,[p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.tempCoupon.is_enabled=s),disabled:o.inputDisabled,class:"form-select w-100",id:"enabled"},at,8,st),[[x,o.tempCoupon.is_enabled]])]),o.tempCoupon.is_enabled?(d(),c("i",it)):(d(),c("i",dt))]),t("div",ct,[t("button",{onClick:e[3]||(e[3]=(...s)=>n.togglerEdit&&n.togglerEdit(...s)),type:"button",class:"btn btn-warning"},"修改優惠卷")])])])]),t("div",pt,[t("div",ut,[rt,t("form",null,[t("div",_t,[mt,t("div",ht,[p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.tempCoupon.title=s),disabled:o.inputDisabled,type:"text",class:"form-control",id:"title"},null,8,bt),[[r,o.tempCoupon.title,void 0,{lazy:!0}]])])]),t("div",ft,[Ct,t("div",vt,[p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.tempCoupon.code=s),disabled:o.inputDisabled,type:"text",class:"form-control",id:"code"},null,8,gt),[[r,o.tempCoupon.code,void 0,{lazy:!0}]])])]),t("div",Dt,[wt,t("div",yt,[p(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.tempCoupon.percent=s),disabled:o.inputDisabled,type:"text",class:"form-control",id:"percent"},null,8,Pt),[[r,o.tempCoupon.percent,void 0,{lazy:!0}]])])])])]),t("div",It,[Tt,t("form",null,[t("div",xt,[Et,t("div",kt,[p(t("input",{onChange:e[7]||(e[7]=(...s)=>n.validateDateInput&&n.validateDateInput(...s)),"onUpdate:modelValue":e[8]||(e[8]=s=>o.tempCoupon.start_date=s),disabled:o.inputDisabled,class:"form-control",type:"date",id:"dateInput"},null,40,Vt),[[r,o.tempCoupon.start_date]])])]),t("div",Mt,[At,t("div",Lt,[p(t("input",{onChange:e[9]||(e[9]=(...s)=>n.validateDateInput&&n.validateDateInput(...s)),"onUpdate:modelValue":e[10]||(e[10]=s=>o.tempCoupon.due_date=s),disabled:o.inputDisabled,class:"form-control",type:"date",id:"dateInput"},null,40,Ut),[[r,o.tempCoupon.due_date]])])])])])])])]),t("div",St,[t("button",{onClick:e[11]||(e[11]=(...s)=>n.cancelUpdate&&n.cancelUpdate(...s)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{onClick:e[12]||(e[12]=(...s)=>n.updateCoupon&&n.updateCoupon(...s)),type:"button",class:"btn btn-danger"}," 確認 ")])])])])}const Nt=w(B,[["render",Bt],["__scopeId","data-v-7034c0d9"]]);var Rt={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:Ot,VITE_APP_PATH:jt}=Rt,Ht={components:{CouponModal:Nt,Pagination:U},data(){return{title:"訂單列表",tempCouponList:[],selectedCoupon:{},isNew:!1}},created(){this.tempCouponList=[...this.couponList]},watch:{couponList:{deep:!0,handler(l){this.tempCouponList=l}}},computed:{...V(b,["couponList","pagination"])},mounted(){this.getCoupons()},methods:{...D(b,["getCoupons"]),formatDate(l){const{formattedDate:e}=P(l);return e},openModal(l,e){l==="new"?(this.selectedCoupon={},this.isNew=!0,this.$refs.couponModal.couponModal.show()):l==="edit"&&(this.selectedCoupon={...e},this.isNew=!1,this.$refs.couponModal.couponModal.show())},deleteCoupon(l){const e=`${Ot}/api/${jt}/admin/coupon/${l}`;this.axios.delete(e).then(_=>{h.fire({title:_.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.getCoupons()})}}},zt={class:"container"},qt={class:"row py-2"},Ft={class:"col mt-4 mb-4"},Xt={class:"container py-2"},Kt=t("h2",null,"這是優惠卷頁面",-1),Gt={class:"d-flex justify-content-between gap-2 py-2"},Jt={class:"p-2 mb-0"},Qt={class:"d-flex justify-content-end gap-2"},Wt={class:"container"},Yt={class:"table table-hover"},Zt=t("thead",{class:"table-dark"},[t("tr",null,[t("th",{scope:"col",class:"fw-bold"},"優惠卷標題"),t("th",{scope:"col",class:"fw-bold"},"優惠碼"),t("th",{scope:"col",class:"fw-bold"},"折扣"),t("th",{scope:"col",class:"fw-bold"},"起始日"),t("th",{scope:"col",class:"fw-bold"},"截止日"),t("th",{scope:"col",class:"fw-bold"},"啟用狀態"),t("th")])],-1),$t={key:0},te=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何優惠卷 ")],-1),ee=[te],oe={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},se={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},le={class:"btn-group",role:"group","aria-label":"Basic outlined example"},ne=["onClick"],ae=["onClick"];function ie(l,e,_,m,o,n){const s=f("coupon-modal"),I=f("Pagination");return d(),c("main",zt,[t("div",qt,[t("main",Ft,[t("div",Xt,[Kt,t("div",Gt,[t("p",Jt,u(`一頁顯示 ${Object.keys(this.tempCouponList).length} 項商品`),1),t("div",Qt,[t("button",{onClick:e[0]||(e[0]=i=>n.openModal("new")),type:"button",class:"btn btn-danger"}," 新增優惠卷 ")]),C(s,{ref:"couponModal",currentCoupon:o.selectedCoupon,"is-new":o.isNew},null,8,["currentCoupon","is-new"])])]),t("div",Wt,[t("table",Yt,[Zt,t("tbody",null,[o.tempCouponList?y("",!0):(d(),c("tr",$t,ee)),(d(!0),c(M,null,A(o.tempCouponList,i=>(d(),c("tr",{key:i.title},[t("td",null,u(i.title),1),t("td",null,u(i.code),1),t("td",null,u(i.percent),1),t("td",null,u(n.formatDate(i.start_date)),1),t("td",null,u(n.formatDate(i.due_date)),1),t("td",null,[i.is_enabled?(d(),c("i",oe)):(d(),c("i",se))]),t("td",null,[t("div",le,[t("button",{onClick:T=>n.openModal("edit",i),type:"button",class:"btn btn-outline-primary btn-sm"}," 編輯 ",8,ne),t("button",{onClick:T=>n.deleteCoupon(i.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,ae)])])]))),128))])])]),C(I,{pages:l.pagination,onShowPage:l.getCoupons},null,8,["pages","onShowPage"])])])])}const re=w(Ht,[["render",ie]]);export{re as default};
