import{e as N,f as T,g as U,_ as $,o as i,c as n,a as t,d as P,t as d,h as D,v as q,F as m,i as b,m as _,j as g,n as C,k as w,S as f,r as p,b as h,l as L,p as V,q as A}from"./index-SKB7VdvU.js";import{c as M}from"./cartStore-7JQs7NSY.js";import{M as O}from"./modal-gyf6dBOh.js";import{C as K}from"./CartList-qHHiC66V.js";const j=N.useLoading({}),E="https://vue3-course-api.hexschool.io/v2",F="runweiting",y=T("productsStore",{state:()=>({productList:[],pagination:{},fullPage:!1}),actions:{async getProducts(s,o=1){const a=j.show();let r=`${E}/api/${F}/products?page=${o}`;s&&(r+=`&category=${s}`);try{const c=await U.get(r),{products:l,pagination:e}=c.data;this.productList=l,this.pagination=e,this.sortProducts()}finally{a.hide()}},sortProducts(){this.productList=this.productList.sort((s,o)=>s.price-o.price)}},getters:{}}),I="https://vue3-course-api.hexschool.io/v2",z="runweiting",k=T("categoryStore",{state:()=>({categoryList:[]}),actions:{getCategory(){const s=`${I}/api/${z}/products/all`;U.get(s).then(o=>{const{products:a}=o.data,r=new Set(a.map(c=>c.category));this.categoryList=[...r]})}}}),G={props:{product:Object},emits:["addToCart"],data(){return{showModal:null,qty:1}},mounted(){this.showModal=new O(document.querySelector("#showModal"),{keyboard:!1,backdrop:"static"})},methods:{openModal(){this.showModal.show()},hideModal(){this.showModal.hide()},addToCart(s){this.$emit("addToCart",s,this.qty)}},watch:{product(){this.qty=1}}},H={class:"modal fade modal-lg",id:"showModal",tabindex:"-1","aria-labelledby":"showModalLabel","aria-hidden":"true"},J={class:"modal-dialog modal-dialog-centered"},R={class:"modal-content"},W={class:"modal-header"},X={class:"modal-title",id:"delModalLabel"},Y={class:"badge bg-dark ms-2"},Z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),tt={class:"modal-body"},st={class:"container-fluid"},ot={class:"row"},et={class:"col-sm-4"},at=["src"],it={class:"col-sm-8"},nt=t("small",{class:"mb-2 text-secondary"},"商品敘述：",-1),dt={class:"mb-3"},ct=t("small",{class:"mb-2 text-secondary"},"商品內容：",-1),rt={class:"mb-3"},lt={class:"mb-3"},ut={class:"fs-6 fw-bold text-secondary me-2"},pt={class:"fs-5 fw-bold text-danger"},ht={class:"input-group"},_t=["value"];function gt(s,o,a,r,c,l){return i(),n("div",H,[t("div",J,[t("div",R,[t("div",W,[t("h5",X,[P(d(a.product.title)+" ",1),t("span",Y,d(a.product.category),1)]),Z]),t("div",tt,[t("div",st,[t("div",ot,[t("div",et,[t("img",{src:a.product.imageUrl,class:"img-fluid"},null,8,at)]),t("div",it,[nt,t("p",dt,d(a.product.description),1),ct,t("p",rt,d(a.product.content),1),t("div",lt,[t("del",ut," 原價"+d(a.product.origin_price)+"元 ",1),t("span",pt," 現在只要"+d(a.product.price)+"元 ",1)]),t("div",ht,[D(t("select",{class:"form-select","onUpdate:modelValue":o[0]||(o[0]=e=>this.qty=e)},[(i(),n(m,null,b(10,e=>t("option",{key:e,value:e},d(e),9,_t)),64))],512),[[q,this.qty]]),t("button",{onClick:o[1]||(o[1]=e=>l.addToCart(a.product.id,this.qty)),type:"button",class:"btn btn-primary"}," 加入購物車 ")])])])])])])])])}const mt=$(G,[["render",gt]]),yt={data(){return{currentCategory:""}},watch:{currentCategory(){this.getProducts(1,this.currentCategory)}},computed:{..._(k,["categoryList"])},methods:{...g(y,["getProducts"])}},$t=t("option",{value:""},"全部",-1),ft=["value"];function bt(s,o,a,r,c,l){return i(),n("div",null,[D(t("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>c.currentCategory=e),class:"form-select form-select-sm"},[$t,(i(!0),n(m,null,b(s.categoryList,e=>(i(),n("option",{key:e,value:e},d(e),9,ft))),128))],512),[[q,c.currentCategory]])])}const vt=$(yt,[["render",bt]]),Ct={computed:{..._(y,["pagination"])},methods:{...g(y,["getProducts"])}},wt={class:"px-2"},Pt={"aria-label":"Page navigation example"},kt={class:"pagination"},St=t("span",{"aria-hidden":"true"},"«",-1),xt=[St],Lt={key:0,class:"page-link"},Mt=["onClick"],Tt=t("span",{"aria-hidden":"true"},"»",-1),Ut=[Tt];function Dt(s,o,a,r,c,l){return i(),n("div",wt,[t("nav",Pt,[t("ul",kt,[t("li",{class:C([{disabled:s.pagination.current_page===1},"page-item"])},[t("a",{onClick:o[0]||(o[0]=w(e=>s.getProducts(s.pagination.current_page-1),["prevent"])),class:"page-link",href:"#","aria-label":"Previous"},xt)],2),(i(!0),n(m,null,b(s.pagination.total_pages,(e,v)=>(i(),n("li",{key:v,class:C([{active:e===s.pagination.current_page},"page-item"])},[e===s.pagination.current_page?(i(),n("span",Lt,d(e),1)):(i(),n("a",{key:1,onClick:w(x=>s.getProducts(e),["prevent"]),class:"page-link",href:"#"},d(e),9,Mt))],2))),128)),t("li",{class:C([{disabled:s.pagination.current_page===s.pagination.total_pages},"page-item"])},[t("a",{onClick:o[1]||(o[1]=w(e=>s.getProducts(s.pagination.current_page+1),["prevent"])),class:"page-link",href:"#","aria-label":"Next"},Ut)],2)])])])}const qt=$(Ct,[["render",Dt]]),Qt={components:{ShowModal:mt,CartList:K,CategoryList:vt,PaginationGroup:qt},data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"runweiting",title:"商品列表",productListNum:null,product:{},fullPage:!1,loadingStatus:{getProduct:"",updateQty:""}}},mounted(){this.getProducts(),this.getCart(),this.getCategory()},computed:{..._(y,["productList"]),..._(M,["cartList","cartTotal"]),..._(k,["categoryList"])},methods:{...g(y,["getProducts"]),...g(M,["getCart"]),...g(k,["getCategory"]),getProduct(s){this.loadingStatus.getProduct=s;const o=`${this.apiUrl}/api/${this.apiPath}/product/${s}`;this.axios.get(o).then(a=>{this.loadingStatus.getProduct="",this.product=a.data.product,this.$refs.showModal.openModal()})},addToCart(s,o=1){this.loadingStatus.updateQty=s;const a=`${this.apiUrl}/api/${this.apiPath}/cart`,r={product_id:s,qty:o};this.$refs.showModal.hideModal(),this.axios.post(a,{data:r}).then(c=>{f.fire({title:c.data.message,icon:"success",confirmButtonText:"OK"}),this.loadingStatus.updateQty="",this.getCart()})},putCart(s){this.loadingStatus.updateQty=s.id;const o=`${this.apiUrl}/api/${this.apiPath}/cart/${s.id}`,a={product_id:s.product_id,qty:s.qty};this.axios.put(o,{data:a}).then(r=>{f.fire({title:r.data.message,icon:"success",confirmButtonText:"OK"}),this.loadingStatus.updateQty="",this.getCart()})},deleteCart(s){const o=`${this.apiUrl}/api/${this.apiPath}/cart/${s}`;this.axios.delete(o).then(a=>{f.fire({title:a.data.message,icon:"success",confirmButtonText:"OK"}),this.getCart()})},deleteCarts(){const s=`${this.apiUrl}/api/${this.apiPath}/carts`;this.axios.delete(s).then(o=>{f.fire({title:o.data.message,icon:"success",confirmButtonText:"OK"}),this.getCart()})}}},S=s=>(V("data-v-40b1e1a9"),s=s(),A(),s),Bt={class:"col-8 mt-4 mb-4",ref:"productList"},Nt={class:"container d-flex justify-content-between"},Vt={class:"p-2 mb-0"},At={class:"container table-responsive"},Ot={class:"table table-hover align-middle"},Kt={class:"table-secondary"},jt={class:"align-middle",style:{height:"48px"}},Et={scope:"col",style:{width:"17%"}},Ft=S(()=>t("th",{scope:"col",class:"fw-bold",style:{width:"30%"}},"商品名稱",-1)),It=S(()=>t("th",{scope:"col",class:"fw-bold",style:{width:"28%"}},"價格",-1)),zt=S(()=>t("th",{scope:"col",style:{width:"25%"}},null,-1)),Gt=["src"],Ht={key:0,class:"fs-5 fw-bold mb-0"},Jt={key:1},Rt={class:"fs-6 fw-bold text-secondary"},Wt={class:"fs-5 fw-bold mb-0"},Xt={class:"d-flex flex-column gap-2"},Yt=["disabled","onClick"],Zt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ts=["onClick"],ss={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function os(s,o,a,r,c,l){const e=p("category-list"),v=p("pagination-group"),x=p("show-modal"),Q=p("cart-list");return i(),n(m,null,[t("div",Bt,[t("div",Nt,[t("h2",null,d(c.title),1),t("p",Vt,d(`目前有 ${s.productList.length} 項商品`),1)]),t("div",At,[t("table",Ot,[t("thead",Kt,[t("tr",jt,[t("th",Et,[h(e)]),Ft,It,zt])]),t("tbody",null,[(i(!0),n(m,null,b(s.productList,u=>(i(),n("tr",{key:u.title},[t("td",null,[t("img",{src:u.imageUrl,class:"rounded product-img"},null,8,Gt)]),t("td",null,d(u.title),1),t("td",null,[u.origin_price===u.price?(i(),n("p",Ht,d(u.price)+"元 ",1)):(i(),n("div",Jt,[t("del",Rt,"原價"+d(u.origin_price)+"元",1),t("p",Wt,"現在只要"+d(u.price)+"元",1)]))]),t("td",null,[t("div",Xt,[t("button",{disabled:u.id===this.loadingStatus.getProduct,onClick:B=>l.getProduct(u.id),type:"button",class:"btn btn-outline-secondary",id:"modalBtn"},[P(" 查看更多 "),u.id===this.loadingStatus.getProduct?(i(),n("span",Zt)):L("",!0)],8,Yt),t("button",{onClick:B=>l.addToCart(u.id),type:"button",class:"btn btn-outline-danger"},[P(" 加入購物車 "),u.id===this.loadingStatus.updateQty?(i(),n("span",ss)):L("",!0)],8,ts)])])]))),128))])]),h(v)]),h(x,{ref:"showModal",product:c.product,onAddToCart:l.addToCart},null,8,["product","onAddToCart"])],512),h(Q,{updateQty:c.loadingStatus.updateQty,onUpdateData:l.putCart,onDeleteData:l.deleteCart,onDeleteAllData:l.deleteCarts,class:"sticky"},null,8,["updateQty","onUpdateData","onDeleteData","onDeleteAllData"])],64)}const es=$(Qt,[["render",os],["__scopeId","data-v-40b1e1a9"]]),as={components:{ProductList:es}},is={class:"container"},ns=t("h1",{class:"pt-5 text-center"},"商品列表",-1),ds={class:"row py-2"};function cs(s,o,a,r,c,l){const e=p("product-list");return i(),n("main",is,[ns,t("div",ds,[h(e)])])}const hs=$(as,[["render",cs]]);export{hs as default};
