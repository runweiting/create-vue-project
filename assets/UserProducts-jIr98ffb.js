import{e as V,f as M,g as x,_ as y,o as n,c as i,a as t,d as C,t as d,h as T,v as U,F as m,i as b,m as _,j as g,n as v,k as w,S as B,r as p,b as h,l as L,p as j,q as A}from"./index-rw1dmYIz.js";import{l as Q,c as D}from"./cartStore-ioxCxxjo.js";import{M as E}from"./modal-fL2mFfTo.js";import{C as F}from"./CartList-3EbwPv-V.js";const I=V.useLoading({}),O="https://vue3-course-api.hexschool.io/v2",z="runweiting",$=M("productsStore",{state:()=>({productList:[],pagination:{},fullPage:!1}),actions:{async getProducts(s,e=1){const a=I.show();let l=`${O}/api/${z}/products?page=${e}`;s&&(l+=`&category=${s}`);try{const c=await x.get(l),{products:u,pagination:o}=c.data;this.productList=u,this.pagination=o,this.sortProducts()}finally{a.hide()}},sortProducts(){this.productList=this.productList.sort((s,e)=>s.price-e.price)}},getters:{}}),G="https://vue3-course-api.hexschool.io/v2",K="runweiting",k=M("categoryStore",{state:()=>({categoryList:[]}),actions:{getCategory(){const s=`${G}/api/${K}/products/all`;x.get(s).then(e=>{const{products:a}=e.data,l=new Set(a.map(c=>c.category));this.categoryList=[...l]})}}}),H={props:{product:Object},emits:["addToCart"],data(){return{showModal:null,qty:1}},mounted(){this.showModal=new E(document.querySelector("#showModal"),{keyboard:!1,backdrop:"static"})},methods:{openModal(){this.showModal.show()},hideModal(){this.showModal.hide()},addToCart(s){this.$emit("addToCart",s,this.qty)}},watch:{product(){this.qty=1}}},J={class:"modal fade modal-lg",id:"showModal",tabindex:"-1","aria-labelledby":"showModalLabel","aria-hidden":"true"},R={class:"modal-dialog modal-dialog-centered"},W={class:"modal-content"},X={class:"modal-header"},Y={class:"modal-title",id:"delModalLabel"},Z={class:"badge bg-dark ms-2"},tt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),st={class:"modal-body"},ot={class:"container-fluid"},et={class:"row"},at={class:"col-sm-4"},nt=["src"],it={class:"col-sm-8"},dt=t("small",{class:"mb-2 text-secondary"},"商品敘述：",-1),ct={class:"mb-3"},rt=t("small",{class:"mb-2 text-secondary"},"商品內容：",-1),lt={class:"mb-3"},ut={class:"mb-3"},pt={class:"fs-6 fw-bold text-secondary me-2"},ht={class:"fs-5 fw-bold text-danger"},_t={class:"input-group"},gt=["value"];function mt(s,e,a,l,c,u){return n(),i("div",J,[t("div",R,[t("div",W,[t("div",X,[t("h5",Y,[C(d(a.product.title)+" ",1),t("span",Z,d(a.product.category),1)]),tt]),t("div",st,[t("div",ot,[t("div",et,[t("div",at,[t("img",{src:a.product.imageUrl,class:"img-fluid"},null,8,nt)]),t("div",it,[dt,t("p",ct,d(a.product.description),1),rt,t("p",lt,d(a.product.content),1),t("div",ut,[t("del",pt," 原價"+d(a.product.origin_price)+"元 ",1),t("span",ht," 現在只要"+d(a.product.price)+"元 ",1)]),t("div",_t,[T(t("select",{class:"form-select","onUpdate:modelValue":e[0]||(e[0]=o=>this.qty=o)},[(n(),i(m,null,b(10,o=>t("option",{key:o,value:o},d(o),9,gt)),64))],512),[[U,this.qty]]),t("button",{onClick:e[1]||(e[1]=o=>u.addToCart(a.product.id,this.qty)),type:"button",class:"btn btn-primary"}," 加入購物車 ")])])])])])])])])}const $t=y(H,[["render",mt]]),yt={data(){return{currentCategory:""}},watch:{currentCategory(){this.getProducts(1,this.currentCategory)}},computed:{..._(k,["categoryList"])},methods:{...g($,["getProducts"])}},bt=t("option",{value:""},"全部",-1),ft=["value"];function vt(s,e,a,l,c,u){return n(),i("div",null,[T(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>c.currentCategory=o),class:"form-select form-select-sm"},[bt,(n(!0),i(m,null,b(s.categoryList,o=>(n(),i("option",{key:o,value:o},d(o),9,ft))),128))],512),[[U,c.currentCategory]])])}const wt=y(yt,[["render",vt]]),Ct={computed:{..._($,["pagination"])},methods:{...g($,["getProducts"])}},kt={class:"px-2"},Pt={"aria-label":"Page navigation example"},St={class:"pagination"},Lt=t("span",{"aria-hidden":"true"},"«",-1),Mt=[Lt],xt={key:0,class:"page-link"},Tt=["onClick"],Ut=t("span",{"aria-hidden":"true"},"»",-1),qt=[Ut];function Nt(s,e,a,l,c,u){return n(),i("div",kt,[t("nav",Pt,[t("ul",St,[t("li",{class:v([{disabled:s.pagination.current_page===1},"page-item"])},[t("a",{onClick:e[0]||(e[0]=w(o=>s.getProducts(s.pagination.current_page-1),["prevent"])),class:"page-link",href:"#","aria-label":"Previous"},Mt)],2),(n(!0),i(m,null,b(s.pagination.total_pages,(o,f)=>(n(),i("li",{key:f,class:v([{active:o===s.pagination.current_page},"page-item"])},[o===s.pagination.current_page?(n(),i("span",xt,d(o),1)):(n(),i("a",{key:1,onClick:w(S=>s.getProducts(o),["prevent"]),class:"page-link",href:"#"},d(o),9,Tt))],2))),128)),t("li",{class:v([{disabled:s.pagination.current_page===s.pagination.total_pages},"page-item"])},[t("a",{onClick:e[1]||(e[1]=w(o=>s.getProducts(s.pagination.current_page+1),["prevent"])),class:"page-link",href:"#","aria-label":"Next"},qt)],2)])])])}const Vt=y(Ct,[["render",Nt]]),Bt={components:{ShowModal:$t,CartList:F,CategoryList:wt,PaginationGroup:Vt},data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"runweiting",title:"商品列表",productListNum:null,product:{},fullPage:!1}},mounted(){this.getProducts(),this.getCart(),this.getCategory()},computed:{..._($,["productList"]),..._(k,["categoryList"]),..._(Q,["loadingStatus"])},methods:{...g($,["getProducts"]),...g(D,["getCart"]),...g(k,["getCategory"]),getProduct(s){this.loadingStatus.getProduct=s;const e=`${this.apiUrl}/api/${this.apiPath}/product/${s}`;this.axios.get(e).then(a=>{this.loadingStatus.getProduct="",this.product=a.data.product,this.$refs.showModal.openModal()})},addToCart(s,e=1){this.loadingStatus.updateQty=s;const a=`${this.apiUrl}/api/${this.apiPath}/cart`,l={product_id:s,qty:e};this.$refs.showModal.hideModal(),this.axios.post(a,{data:l}).then(c=>{B.fire({title:c.data.message,icon:"success",confirmButtonText:"OK"}),this.loadingStatus.updateQty="",this.getCart()})}}},P=s=>(j("data-v-36a738d8"),s=s(),A(),s),jt={class:"col-8 mt-4 mb-4",ref:"productList"},At={class:"container d-flex justify-content-between"},Qt={class:"p-2 mb-0"},Dt={class:"container table-responsive"},Et={class:"table table-hover align-middle"},Ft={class:"table-secondary"},It={class:"align-middle",style:{height:"48px"}},Ot={scope:"col",style:{width:"17%"}},zt=P(()=>t("th",{scope:"col",class:"fw-bold",style:{width:"30%"}},"商品名稱",-1)),Gt=P(()=>t("th",{scope:"col",class:"fw-bold",style:{width:"28%"}},"價格",-1)),Kt=P(()=>t("th",{scope:"col",style:{width:"25%"}},null,-1)),Ht=["src"],Jt={key:0,class:"fs-5 fw-bold mb-0"},Rt={key:1},Wt={class:"fs-6 fw-bold text-secondary"},Xt={class:"fs-5 fw-bold mb-0"},Yt={class:"d-flex flex-column gap-2"},Zt=["disabled","onClick"],ts={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ss=["onClick"],os={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function es(s,e,a,l,c,u){const o=p("category-list"),f=p("pagination-group"),S=p("show-modal"),q=p("cart-list");return n(),i(m,null,[t("div",jt,[t("div",At,[t("h2",null,d(c.title),1),t("p",Qt,d(`目前有 ${s.productList.length} 項商品`),1)]),t("div",Dt,[t("table",Et,[t("thead",Ft,[t("tr",It,[t("th",Ot,[h(o)]),zt,Gt,Kt])]),t("tbody",null,[(n(!0),i(m,null,b(s.productList,r=>(n(),i("tr",{key:r.title},[t("td",null,[t("img",{src:r.imageUrl,class:"rounded product-img"},null,8,Ht)]),t("td",null,d(r.title),1),t("td",null,[r.origin_price===r.price?(n(),i("p",Jt,d(r.price)+"元 ",1)):(n(),i("div",Rt,[t("del",Wt,"原價"+d(r.origin_price)+"元",1),t("p",Xt,"現在只要"+d(r.price)+"元",1)]))]),t("td",null,[t("div",Yt,[t("button",{disabled:r.id===this.loadingStatus.getProduct,onClick:N=>u.getProduct(r.id),type:"button",class:"btn btn-outline-secondary",id:"modalBtn"},[C(" 查看更多 "),r.id===this.loadingStatus.getProduct?(n(),i("span",ts)):L("",!0)],8,Zt),t("button",{onClick:N=>u.addToCart(r.id),type:"button",class:"btn btn-outline-danger"},[C(" 加入購物車 "),r.id===this.loadingStatus.updateQty?(n(),i("span",os)):L("",!0)],8,ss)])])]))),128))])]),h(f)]),h(S,{ref:"showModal",product:c.product,onAddToCart:u.addToCart},null,8,["product","onAddToCart"])],512),h(q,{class:"sticky"})],64)}const as=y(Bt,[["render",es],["__scopeId","data-v-36a738d8"]]),ns={components:{ProductList:as}},is={class:"container"},ds=t("h1",{class:"pt-5 text-center"},"商品列表",-1),cs={class:"row py-2"};function rs(s,e,a,l,c,u){const o=p("product-list");return n(),i("main",is,[ds,t("div",cs,[h(o)])])}const _s=y(ns,[["render",rs]]);export{_s as default};
