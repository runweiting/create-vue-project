import{v as L,x as U,q as x,S as b,_ as P,o as i,c,a as e,t as r,y as _,z as I,I as m,F as E,s as k,C as D,A as h,D as S,E as C,d as O,m as M,r as v,b as T}from"./index-CU5lGkkf.js";import{t as V}from"./timestampToDate-lwWXufjj.js";import{M as R,P as j}from"./Pagination-1lXEQ2Nu.js";var B={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:H,VITE_APP_PATH:q}=B,g=L("orderStore",{state:()=>({orderList:[],pagination:{}}),actions:{getOrders(l=1){const t=`${H}/api/${q}/admin/orders?page=${l}`;U.get(t).then(u=>{const{orders:f,pagination:s}=u.data,d=f.map(o=>({...o,calculateTotal:this.updateTotal(o)}));this.orderList=d,this.pagination=s,console.log(this.orderList)})},updateTotal(l){if(!l||!l.products)return 0;let t=0;return Object.values(l.products).forEach(u=>{t+=u.qty*u.product.price}),t}}});var N={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:F,VITE_APP_PATH:X}=N,z={props:{currentOrder:Object},data(){return{orderModal:null,tempOrder:{},inputDisabled:!0,subTotal:0}},created(){this.tempOrder={...this.currentOrder,products:{},user:{email:"",name:"",tel:"",address:""}}},watch:{currentOrder:{deep:!0,handler(l){this.tempOrder=l}}},mounted(){this.orderModal=new R(document.querySelector("#orderModal"),{keyboard:!1,backdrop:"static"}),console.log(this.tempOrder)},methods:{...x(g,["getOrders","timestampToDate"]),formatDate(l){const{formattedDay:t,formattedDate:u}=V(l);return{formattedDay:t,formattedDate:u}},togglerEdit(){this.inputDisabled=!1,this.updateTotal()},updateTotal(){this.subTotal=this.tempOrder.calculateTotal;let l=0;Object.values(this.tempOrder.products).forEach(t=>{l+=t.qty*t.product.price}),this.subTotal=l},cancelUpdateOrder(){this.subTotal=0,this.inputDisabled=!0},updateOrder(){const l=`${F}/api/${X}/admin/order/${this.tempOrder.id}`;this.axios.put(l,{data:this.tempOrder}).then(t=>{b.fire({title:t.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.subTotal=0,this.inputDisabled=!0,this.orderModal.hide(),this.getOrders(),this.tempOrder=[...this.currentOrder]}).catch(t=>{b.fire({title:t.response.data.message,icon:"error",confirmButtonText:"OK"})})}}},a=l=>(S("data-v-1969b57f"),l=l(),C(),l),K={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},G={class:"modal-dialog modal-xl modal-dialog-centered"},J={class:"modal-content"},Q={class:"modal-header bg-dark opacity-75 text-white"},W={class:"modal-title",id:"orderModalLabel"},Y=a(()=>e("br",null,null,-1)),Z=a(()=>e("i",{class:"bi bi-x-lg"},null,-1)),$=[Z],ee={class:"modal-body"},te={class:"container-fluid"},se={class:"row mb-5"},oe={class:"border rounded p-2 bg-light"},le={class:"row mb-2"},de={class:"col-md-5 d-flex align-items-center gap-3"},re=a(()=>e("label",{for:"payment",class:"col-form-label"},"付款狀態：",-1)),ae=["disabled"],ne=a(()=>e("option",{value:!0}," 已付款 ",-1)),ie=a(()=>e("option",{value:!1}," 未付款 ",-1)),ce=[ne,ie],ue={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},_e={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},pe={class:"col-md-7"},me={class:"row"},he={class:"col-md-5"},be=a(()=>e("h5",null,"訂購資訊",-1)),fe={class:"row mb-2"},Oe=a(()=>e("label",{for:"date",class:"col-sm-3 col-form-label"},"建立時間：",-1)),ge={class:"col-sm-9"},ve=["disabled"],Te={class:"row mb-2"},ye=a(()=>e("label",{for:"Email",class:"col-sm-3 col-form-label"},"Email：",-1)),we={class:"col-sm-9"},xe=["disabled"],Pe={class:"row mb-2"},Ee=a(()=>e("label",{for:"name",class:"col-sm-3 col-form-label"},"收件姓名：",-1)),ke={class:"col-sm-9"},De=["disabled"],Ve={class:"row mb-2"},Ae=a(()=>e("label",{for:"tel",class:"col-sm-3 col-form-label"},"聯絡電話：",-1)),Le={class:"col-sm-9"},Ue=["disabled"],Ie={class:"row mb-2"},Se=a(()=>e("label",{for:"address",class:"col-sm-3 col-form-label"},"收件地址：",-1)),Ce={class:"col-sm-9"},Me=["disabled"],Re={class:"row mb-2"},je=a(()=>e("label",{for:"note",class:"col-sm-3 col-form-label"},"留言：",-1)),Be={class:"col-sm-9"},He=["disabled"],qe={class:"col-md-7"},Ne=a(()=>e("div",{class:"container"},[e("div",{class:"d-flex justify-content-between"},[e("h5",null,"商品內容")])],-1)),Fe={class:"container table-responsive"},Xe={class:"table table-hover align-middle"},ze=a(()=>e("thead",{class:"table-warning"},[e("tr",{class:"align-middle",style:{height:"48px"}},[e("th",{scope:"col",class:"fw-bold",style:{width:"60%"}},"商品"),e("th",{scope:"col",class:"fw-bold",style:{width:"20%"}},"數量"),e("th",{scope:"col",class:"fw-bold text-end",style:{width:"15%"}},"單價"),e("th",{style:{width:"5%"}})])],-1)),Ke={class:"d-flex align-items-center gap-2"},Ge=["src"],Je=a(()=>e("br",null,null,-1)),Qe={key:0,class:"text-danger"},We={class:"pe-0"},Ye={class:"d-flex justify-content-between align-items-center"},Ze={class:"input-group input-group-sm"},$e=["onUpdate:modelValue","disabled"],et={class:"input-group-text"},tt={class:"text-end"},st={class:"fs-6 mb-0"},ot={class:"text-end p-0"},lt=["disabled"],dt=a(()=>e("td",null,[O(" 原始金額： "),e("br"),O(" 更新金額： "),e("br"),O(" 折扣金額： ")],-1)),rt={class:"text-end text-danger fw-bold"},at=a(()=>e("br",null,null,-1)),nt=a(()=>e("br",null,null,-1)),it={key:0},ct=a(()=>e("td",null,null,-1)),ut={class:"modal-footer"};function _t(l,t,u,f,s,d){return i(),c("div",K,[e("div",G,[e("div",J,[e("div",Q,[e("h5",W,[e("span",null,"訂單編號："+r(s.tempOrder.id),1),Y]),e("button",{onClick:t[0]||(t[0]=(...o)=>d.cancelUpdateOrder&&d.cancelUpdateOrder(...o)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},$)]),e("div",ee,[e("div",te,[e("div",se,[e("div",oe,[e("div",le,[e("div",de,[re,e("div",null,[_(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.tempOrder.is_paid=o),disabled:s.inputDisabled,class:"form-select",id:"payment"},ce,8,ae),[[I,s.tempOrder.is_paid]])]),s.tempOrder.is_paid?(i(),c("i",ue)):(i(),c("i",_e))]),e("div",pe,[e("button",{onClick:t[2]||(t[2]=(...o)=>d.togglerEdit&&d.togglerEdit(...o)),type:"button",class:"btn btn-warning"},"修改訂單")])])])]),e("div",me,[e("div",he,[be,e("form",null,[e("div",fe,[Oe,e("div",ge,[_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>d.formatDate(s.tempOrder.create_at).formattedDate=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"date"},null,8,ve),[[m,d.formatDate(s.tempOrder.create_at).formattedDate]])])]),e("div",Te,[ye,e("div",we,[_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.tempOrder.user.email=o),disabled:s.inputDisabled,type:"email",class:"form-control",id:"Email"},null,8,xe),[[m,s.tempOrder.user.email]])])]),e("div",Pe,[Ee,e("div",ke,[_(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.tempOrder.user.name=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"name"},null,8,De),[[m,s.tempOrder.user.name]])])]),e("div",Ve,[Ae,e("div",Le,[_(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.tempOrder.user.tel=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"tel"},null,8,Ue),[[m,s.tempOrder.user.tel]])])]),e("div",Ie,[Se,e("div",Ce,[_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.tempOrder.user.address=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"address"},null,8,Me),[[m,s.tempOrder.user.address]])])]),e("div",Re,[je,e("div",Be,[_(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=o=>s.tempOrder.user.message=o),disabled:s.inputDisabled,class:"form-control",name:"note",id:"note",cols:"10",rows:"10",style:{height:"100px"}},null,8,He),[[m,s.tempOrder.user.message]])])])])]),e("div",qe,[Ne,e("div",Fe,[e("table",Xe,[ze,e("tbody",null,[(i(!0),c(E,null,k(s.tempOrder.products,o=>(i(),c("tr",{key:o.id},[e("td",Ke,[e("img",{src:o.product.imageUrl,class:"rounded order-img"},null,8,Ge),e("div",null,[e("small",null,r(o.product.title),1),Je,o.coupon?(i(),c("small",Qe,"優惠碼："+r(o.coupon.code)+"、折數："+r(o.coupon.percent)+"%",1)):D("",!0)])]),e("td",We,[e("div",Ye,[e("div",Ze,[_(e("input",{"onUpdate:modelValue":p=>o.qty=p,disabled:s.inputDisabled,onClick:t[9]||(t[9]=(...p)=>d.updateTotal&&d.updateTotal(...p)),type:"number",min:"1",class:"form-control"},null,8,$e),[[m,o.qty]]),e("span",et,r(o.product.unit),1)])])]),e("td",tt,[e("p",st,r(o.product.price)+"元",1)]),e("td",ot,[e("button",{disabled:s.inputDisabled,onClick:t[10]||(t[10]=(...p)=>l.deleteOrder&&l.deleteOrder(...p)),type:"button",class:"btn btn-outline-danger btn-sm py-0",style:{scale:"80%"}}," x ",8,lt)])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",null,[e("span",null,r(`總共 ${Object.keys(s.tempOrder.products).length} 項`),1)]),dt,e("td",rt,[e("span",{class:h({"fw-normal":s.subTotal,"text-dark":s.subTotal,"text-decoration-line-through":s.subTotal})},r(s.tempOrder.calculateTotal)+"元 ",3),at,e("span",{class:h({"fw-normal":!s.subTotal,"text-dark":!s.subTotal,"text-decoration-line-through":!s.subTotal})},r(s.subTotal)+"元 ",3),nt,s.tempOrder.calculateTotal!==s.tempOrder.total?(i(),c("span",it,r(s.tempOrder.total)+"元 ",1)):(i(),c("span",{key:1,class:h({"fw-normal":s.tempOrder.calculateTotal==s.tempOrder.total,"text-dark":s.tempOrder.calculateTotal==s.tempOrder.total})},"無優惠碼",2))]),ct])])])])])])])]),e("div",ut,[e("button",{onClick:t[11]||(t[11]=(...o)=>d.cancelUpdateOrder&&d.cancelUpdateOrder(...o)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{onClick:t[12]||(t[12]=(...o)=>d.updateOrder&&d.updateOrder(...o)),type:"button",class:"btn btn-danger"}," 更新訂單 ")])])])])}const pt=P(z,[["render",_t],["__scopeId","data-v-1969b57f"]]);var mt={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:y,VITE_APP_PATH:w}=mt,ht={components:{OrderModal:pt,Pagination:j},data(){return{title:"訂單列表",tempOrderList:[],selectedOrder:{}}},created(){this.tempOrderList=[...this.orderList]},watch:{orderList:{deep:!0,handler(l){this.tempOrderList=l}}},computed:{...M(g,["orderList","pagination","calculateTotal"])},mounted(){this.getOrders()},methods:{...x(g,["getOrders"]),formatDate(l){const{formattedDate:t,formattedTime:u}=V(l);return{formattedDate:t,formattedTime:u}},checkOrder(l){this.selectedOrder={...l},console.log("order",this.selectedOrder),this.$refs.orderModal.orderModal.show()},deleteOrder(l){const t=`${y}/api/${w}/admin/order/${l}`;this.axios.delete(t).then(u=>{b.fire({title:u.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.getOrders()})},deleteOrders(){const l=`${y}/api/${w}/admin/orders/all`;this.axios.delete(l).then(t=>{b.fire({title:t.data.message,icon:"success",showConfirmButton:!1,timer:1500}),this.getOrders()})}}},bt={class:"container"},ft={class:"row py-2"},Ot={class:"col mt-4 mb-4"},gt={class:"container py-2"},vt=e("h2",null,"這是訂單頁面",-1),Tt={class:"d-flex justify-content-between gap-2 py-2"},yt={class:"p-2 mb-0"},wt={class:"d-flex justify-content-end gap-2"},xt={class:"container"},Pt={class:"table table-hover"},Et=e("thead",{class:"table-dark"},[e("tr",null,[e("th",{scope:"col",class:"fw-bold"},"日期"),e("th",{scope:"col",class:"fw-bold"},"序號"),e("th",{scope:"col",class:"fw-bold"},"訂單編號"),e("th",{scope:"col",class:"fw-bold"},"品項"),e("th",{scope:"col",class:"fw-bold"},"金額"),e("th",{scope:"col",class:"fw-bold"},"優惠卷"),e("th",{scope:"col",class:"fw-bold"},"訂單狀態"),e("th",{scope:"col",class:"fw-bold"},"付款日期"),e("th")])],-1),kt={key:0},Dt=e("td",{colspan:"7"},[e("small",{class:"text-muted"}," 目前沒有任何訂單 ")],-1),Vt=[Dt],At={class:"d-block"},Lt={class:"text-muted"},Ut={key:0},It={key:1},St={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},Ct={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},Mt=e("td",null,null,-1),Rt={class:"btn-group",role:"group","aria-label":"Basic outlined example"},jt=["onClick"],Bt=["onClick"];function Ht(l,t,u,f,s,d){const o=v("order-modal"),p=v("Pagination");return i(),c("main",bt,[e("div",ft,[e("main",Ot,[e("div",gt,[vt,e("div",Tt,[e("p",yt,r(`一頁顯示 ${Object.keys(this.tempOrderList).length} 項商品`),1),e("div",wt,[e("button",{onClick:t[0]||(t[0]=(...n)=>d.deleteOrders&&d.deleteOrders(...n)),type:"button",class:"btn btn-danger"}," 刪除全部訂單 ")]),T(o,{ref:"orderModal",currentOrder:s.selectedOrder},null,8,["currentOrder"])])]),e("div",xt,[e("table",Pt,[Et,e("tbody",null,[s.tempOrderList?D("",!0):(i(),c("tr",kt,Vt)),(i(!0),c(E,null,k(s.tempOrderList,n=>(i(),c("tr",{key:n.title},[e("td",null,[e("span",At,r(d.formatDate(n.create_at).formattedDate),1),e("small",Lt,r(d.formatDate(n.create_at).formattedTime),1)]),e("td",null,r(n.num),1),e("td",null,r(n.id),1),e("td",null,r(Object.keys(n.products).length),1),e("td",null,[n.total?(i(),c("span",Ut,r(n.total),1)):(i(),c("span",It,r(n.calculateTotal),1))]),e("td",null,[n.calculateTotal!==n.total?(i(),c("i",St)):(i(),c("i",Ct))]),e("td",{class:h({"text-success":n.is_paid,"text-danger":!n.is_paid})},r(n.is_paid?"已付款":"未付款"),3),Mt,e("td",null,[e("div",Rt,[e("button",{onClick:A=>d.checkOrder(n),type:"button",class:"btn btn-outline-primary btn-sm"}," 查看訂單 ",8,jt),e("button",{onClick:A=>d.deleteOrder(n.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Bt)])])]))),128))])])]),T(p,{pages:l.pagination,onShowPage:l.getOrders},null,8,["pages","onShowPage"])])])])}const Xt=P(ht,[["render",Ht]]);export{Xt as default};
