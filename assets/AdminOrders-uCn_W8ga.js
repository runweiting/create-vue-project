import{v as A,x as U,q as x,S as h,_ as P,o as c,c as u,a as t,t as n,y as _,z as L,I as m,F as E,s as D,A as g,D as I,E as S,d as v,m as C,r as T,b as y,C as M}from"./index-XYnlPS3W.js";import{t as V}from"./timestampToDate-lwWXufjj.js";import{M as R,P as j}from"./Pagination-RWycLThs.js";var B={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:H,VITE_APP_PATH:q}=B,O=A("orderStore",{state:()=>({orderList:[],pagination:{}}),actions:{getOrders(o=1){const e=`${H}/api/${q}/admin/orders?page=${o}`;U.get(e).then(i=>{const{orders:b,pagination:s}=i.data,d=b.map(l=>({...l,calculateTotal:this.updateTotal(l)}));this.orderList=d,this.pagination=s})},updateTotal(o){if(!o||!o.products)return 0;let e=0;return Object.values(o.products).forEach(i=>{e+=i.qty*i.product.price}),e}}});var N={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:z,VITE_APP_PATH:F}=N,X={props:{currentOrder:Object},data(){return{orderModal:null,tempOrder:{},inputDisabled:!0,subTotal:0}},created(){this.tempOrder={...this.currentOrder,products:{},user:{email:"",name:"",tel:"",address:""}}},watch:{currentOrder:{deep:!0,handler(o){this.tempOrder=o}}},mounted(){this.orderModal=new R(document.querySelector("#orderModal"),{keyboard:!1,backdrop:"static"}),console.log(this.tempOrder)},methods:{...x(O,["getOrders","timestampToDate"]),formatDate(o){const{formattedDay:e,formattedDate:i}=V(o);return{formattedDay:e,formattedDate:i}},togglerEdit(){this.inputDisabled=!1,this.updateTotal()},updateTotal(){this.subTotal=this.tempOrder.calculateTotal;let o=0;Object.values(this.tempOrder.products).forEach(e=>{o+=e.qty*e.product.price}),this.subTotal=o},cancelUpdateOrder(){this.subTotal=0,this.inputDisabled=!0},updateOrder(){const o=`${z}/api/${F}/admin/order/${this.tempOrder.id}`;this.axios.put(o,{data:this.tempOrder}).then(e=>{h.fire({title:e.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.subTotal=0,this.inputDisabled=!0,this.orderModal.hide(),this.getOrders(),this.tempOrder=[...this.currentOrder]}).catch(e=>{h.fire({title:e.response.data.message,icon:"error",confirmButtonText:"OK"})})}}},r=o=>(I("data-v-3e765c94"),o=o(),S(),o),K={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},G={class:"modal-dialog modal-xl modal-dialog-centered"},J={class:"modal-content"},Q={class:"modal-header bg-dark opacity-75 text-white"},W={class:"modal-title",id:"orderModalLabel"},Y=r(()=>t("br",null,null,-1)),Z=r(()=>t("i",{class:"bi bi-x-lg"},null,-1)),$=[Z],tt={class:"modal-body"},et={class:"container-fluid"},st={class:"row mb-5"},ot={class:"border rounded p-2 bg-light"},lt={class:"row mb-2"},dt={class:"col-md-5 d-flex align-items-center gap-3"},rt=r(()=>t("label",{for:"payment",class:"col-form-label"},"付款狀態：",-1)),at=["disabled"],nt=r(()=>t("option",{value:!0}," 已付款 ",-1)),it=r(()=>t("option",{value:!1}," 未付款 ",-1)),ct=[nt,it],ut={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},_t={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},pt={class:"col-md-7"},mt={class:"row"},ht={class:"col-md-5"},bt=r(()=>t("h5",null,"訂購資訊",-1)),ft={class:"row mb-2"},gt=r(()=>t("label",{for:"date",class:"col-sm-3 col-form-label"},"建立時間：",-1)),Ot={class:"col-sm-9"},vt=["disabled"],Tt={class:"row mb-2"},yt=r(()=>t("label",{for:"Email",class:"col-sm-3 col-form-label"},"Email：",-1)),wt={class:"col-sm-9"},xt=["disabled"],Pt={class:"row mb-2"},Et=r(()=>t("label",{for:"name",class:"col-sm-3 col-form-label"},"收件姓名：",-1)),Dt={class:"col-sm-9"},Vt=["disabled"],kt={class:"row mb-2"},At=r(()=>t("label",{for:"tel",class:"col-sm-3 col-form-label"},"聯絡電話：",-1)),Ut={class:"col-sm-9"},Lt=["disabled"],It={class:"row mb-2"},St=r(()=>t("label",{for:"address",class:"col-sm-3 col-form-label"},"收件地址：",-1)),Ct={class:"col-sm-9"},Mt=["disabled"],Rt={class:"row mb-2"},jt=r(()=>t("label",{for:"note",class:"col-sm-3 col-form-label"},"留言：",-1)),Bt={class:"col-sm-9"},Ht=["disabled"],qt={class:"col-md-7"},Nt=r(()=>t("div",{class:"container"},[t("div",{class:"d-flex justify-content-between"},[t("h5",null,"商品內容"),t("span",{class:"fs-6 text-danger"},"優惠碼：")])],-1)),zt={class:"container table-responsive"},Ft={class:"table table-hover align-middle"},Xt=r(()=>t("thead",{class:"table-warning"},[t("tr",{class:"align-middle",style:{height:"48px"}},[t("th",{scope:"col",class:"fw-bold",style:{width:"60%"}},"商品"),t("th",{scope:"col",class:"fw-bold",style:{width:"20%"}},"數量"),t("th",{scope:"col",class:"fw-bold text-end",style:{width:"15%"}},"單價"),t("th",{style:{width:"5%"}})])],-1)),Kt={class:"d-flex align-items-center gap-1"},Gt=["src"],Jt={class:"pe-0"},Qt={class:"d-flex justify-content-between align-items-center"},Wt={class:"input-group input-group-sm"},Yt=["onUpdate:modelValue","disabled"],Zt={class:"input-group-text"},$t={class:"text-end"},te={class:"fs-6 mb-0"},ee={class:"text-end p-0"},se=["disabled"],oe=r(()=>t("td",null,[v(" 原始金額： "),t("br"),v(" 更新金額： ")],-1)),le={class:"text-end fs-5 text-danger fw-bold"},de=r(()=>t("br",null,null,-1)),re=r(()=>t("td",null,null,-1)),ae={class:"modal-footer"};function ne(o,e,i,b,s,d){return c(),u("div",K,[t("div",G,[t("div",J,[t("div",Q,[t("h5",W,[t("span",null,"訂單編號："+n(s.tempOrder.id),1),Y]),t("button",{onClick:e[0]||(e[0]=(...l)=>d.cancelUpdateOrder&&d.cancelUpdateOrder(...l)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},$)]),t("div",tt,[t("div",et,[t("div",st,[t("div",ot,[t("div",lt,[t("div",dt,[rt,t("div",null,[_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.tempOrder.is_paid=l),disabled:s.inputDisabled,class:"form-select",id:"payment"},ct,8,at),[[L,s.tempOrder.is_paid]])]),s.tempOrder.is_paid?(c(),u("i",ut)):(c(),u("i",_t))]),t("div",pt,[t("button",{onClick:e[2]||(e[2]=(...l)=>d.togglerEdit&&d.togglerEdit(...l)),type:"button",class:"btn btn-warning"},"修改訂單")])])])]),t("div",mt,[t("div",ht,[bt,t("form",null,[t("div",ft,[gt,t("div",Ot,[_(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>d.formatDate(s.tempOrder.create_at).formattedDate=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"date"},null,8,vt),[[m,d.formatDate(s.tempOrder.create_at).formattedDate]])])]),t("div",Tt,[yt,t("div",wt,[_(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.tempOrder.user.email=l),disabled:s.inputDisabled,type:"email",class:"form-control",id:"Email"},null,8,xt),[[m,s.tempOrder.user.email]])])]),t("div",Pt,[Et,t("div",Dt,[_(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.tempOrder.user.name=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"name"},null,8,Vt),[[m,s.tempOrder.user.name]])])]),t("div",kt,[At,t("div",Ut,[_(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.tempOrder.user.tel=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"tel"},null,8,Lt),[[m,s.tempOrder.user.tel]])])]),t("div",It,[St,t("div",Ct,[_(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.tempOrder.user.address=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"address"},null,8,Mt),[[m,s.tempOrder.user.address]])])]),t("div",Rt,[jt,t("div",Bt,[_(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.tempOrder.user.message=l),disabled:s.inputDisabled,class:"form-control",name:"note",id:"note",cols:"10",rows:"10",style:{height:"100px"}},null,8,Ht),[[m,s.tempOrder.user.message]])])])])]),t("div",qt,[Nt,t("div",zt,[t("table",Ft,[Xt,t("tbody",null,[(c(!0),u(E,null,D(s.tempOrder.products,l=>(c(),u("tr",{key:l.id},[t("td",Kt,[t("img",{src:l.product.imageUrl,class:"rounded order-img"},null,8,Gt),t("small",null,n(l.product.title),1)]),t("td",Jt,[t("div",Qt,[t("div",Wt,[_(t("input",{"onUpdate:modelValue":p=>l.qty=p,disabled:s.inputDisabled,onClick:e[9]||(e[9]=(...p)=>d.updateTotal&&d.updateTotal(...p)),type:"number",min:"1",class:"form-control"},null,8,Yt),[[m,l.qty]]),t("span",Zt,n(l.product.unit),1)])])]),t("td",$t,[t("p",te,n(l.product.price)+"元",1)]),t("td",ee,[t("button",{disabled:s.inputDisabled,onClick:e[10]||(e[10]=(...p)=>o.deleteOrder&&o.deleteOrder(...p)),type:"button",class:"btn btn-outline-danger btn-sm py-0",style:{scale:"80%"}}," x ",8,se)])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",null,[t("span",null,n(`總共 ${Object.keys(s.tempOrder.products).length} 項`),1)]),oe,t("td",le,[t("span",{class:g({"fs-6":s.subTotal,"fw-normal":s.subTotal,"text-dark":s.subTotal,"text-decoration-line-through":s.subTotal})},n(s.tempOrder.calculateTotal)+"元 ",3),de,t("span",{class:g({"fs-6":!s.subTotal,"fw-normal":!s.subTotal,"text-dark":!s.subTotal,"text-decoration-line-through":!s.subTotal})},n(s.subTotal)+"元 ",3)]),re])])])])])])])]),t("div",ae,[t("button",{onClick:e[11]||(e[11]=(...l)=>d.cancelUpdateOrder&&d.cancelUpdateOrder(...l)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{onClick:e[12]||(e[12]=(...l)=>d.updateOrder&&d.updateOrder(...l)),type:"button",class:"btn btn-danger"}," 更新訂單 ")])])])])}const ie=P(X,[["render",ne],["__scopeId","data-v-3e765c94"]]);var ce={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:f,VITE_APP_PATH:w}=ce,ue={components:{OrderModal:ie,Pagination:j},data(){return{title:"訂單列表",tempOrderList:[],selectedOrder:{}}},created(){this.tempOrderList=[...this.orderList]},watch:{orderList:{deep:!0,handler(o){this.tempOrderList=o}}},computed:{...C(O,["orderList","pagination","calculateTotal"])},mounted(){this.getOrders()},methods:{...x(O,["getOrders"]),formatDate(o){const{formattedDate:e,formattedTime:i}=V(o);return{formattedDate:e,formattedTime:i}},checkOrder(o){this.selectedOrder={...o},console.log("order",this.selectedOrder),this.$refs.orderModal.orderModal.show()},deleteOrder(o){const e=`${f}/api/${w}/admin/order/${o}`;this.axios.delete(e).then(i=>{h.fire({title:i.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.getOrders()})},deleteOrders(){const o=`${f}/api/${w}/admin/orders/all`;this.axios.delete(o).then(e=>{h.fire({title:e.data.message,icon:"success",showConfirmButton:!1,timer:1500}),this.getOrders()})},logout(){const o=`${f}/logout`;this.axios.post(o).then(e=>{h.fire({title:e.data.message,icon:"success",showConfirmButton:!1,timer:1500}).then(()=>{document.cookie="myToken=; expires=;",this.axios.defaults.headers.common.Authorization=null,this.$router.push({name:"login"})})})}}},_e={class:"container"},pe={class:"row py-2"},me={class:"col mt-4 mb-4"},he={class:"container py-2"},be=t("h2",null,"這是訂單頁面",-1),fe={class:"d-flex justify-content-between gap-2 py-2"},ge={class:"p-2 mb-0"},Oe={class:"d-flex justify-content-end gap-2"},ve={class:"container"},Te={class:"table table-hover"},ye=t("thead",{class:"table-dark"},[t("tr",null,[t("th",{scope:"col",class:"fw-bold"},"日期"),t("th",{scope:"col",class:"fw-bold"},"序號"),t("th",{scope:"col",class:"fw-bold"},"訂單編號"),t("th",{scope:"col",class:"fw-bold"},"品項"),t("th",{scope:"col",class:"fw-bold"},"金額"),t("th",{scope:"col",class:"fw-bold"},"訂單狀態"),t("th",{scope:"col",class:"fw-bold"},"付款日期"),t("th")])],-1),we={key:0},xe=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何訂單 ")],-1),Pe=[xe],Ee={class:"d-block"},De={class:"text-muted"},Ve=t("td",null,null,-1),ke={class:"btn-group",role:"group","aria-label":"Basic outlined example"},Ae=["onClick"],Ue=["onClick"];function Le(o,e,i,b,s,d){const l=T("order-modal"),p=T("Pagination");return c(),u("main",_e,[t("div",pe,[t("main",me,[t("div",he,[be,t("div",fe,[t("p",ge,n(`一頁顯示 ${Object.keys(this.tempOrderList).length} 項商品`),1),t("div",Oe,[t("button",{onClick:e[0]||(e[0]=(...a)=>d.deleteOrders&&d.deleteOrders(...a)),type:"button",class:"btn btn-danger"}," 刪除全部訂單 "),t("button",{onClick:e[1]||(e[1]=(...a)=>d.logout&&d.logout(...a)),type:"button",class:"btn btn-warning"}," 登出 ")]),y(l,{ref:"orderModal",currentOrder:s.selectedOrder},null,8,["currentOrder"])])]),t("div",ve,[t("table",Te,[ye,t("tbody",null,[s.tempOrderList?M("",!0):(c(),u("tr",we,Pe)),(c(!0),u(E,null,D(s.tempOrderList,a=>(c(),u("tr",{key:a.title},[t("td",null,[t("span",Ee,n(d.formatDate(a.create_at).formattedDate),1),t("small",De,n(d.formatDate(a.create_at).formattedTime),1)]),t("td",null,n(a.num),1),t("td",null,n(a.id),1),t("td",null,n(Object.keys(a.products).length),1),t("td",null,n(a.calculateTotal),1),t("td",{class:g({"text-success":a.is_paid,"text-danger":!a.is_paid})},n(a.is_paid?"已付款":"未付款"),3),Ve,t("td",null,[t("div",ke,[t("button",{onClick:k=>d.checkOrder(a),type:"button",class:"btn btn-outline-primary btn-sm"}," 查看訂單 ",8,Ae),t("button",{onClick:k=>d.deleteOrder(a.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Ue)])])]))),128))])])]),y(p,{pages:o.pagination,onShowPage:o.getOrders},null,8,["pages","onShowPage"])])])])}const Me=P(ue,[["render",Le]]);export{Me as default};
