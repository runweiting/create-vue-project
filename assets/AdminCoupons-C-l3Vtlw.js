import{v as x,x as V,q as D,S as h,_ as P,o as d,c,a as t,t as _,y as r,I as m,C as y,z as A,D as k,E as L,m as M,r as f,b as C,F as S,s as U}from"./index-XYnlPS3W.js";import{t as T}from"./timestampToDate-lwWXufjj.js";import{M as R,P as B}from"./Pagination-RWycLThs.js";var N={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:O,VITE_APP_PATH:H}=N,b=x("couponsStore",{state:()=>({couponList:[],pagination:{}}),actions:{getCoupons(o=1){const e=`${O}/api/${H}/admin/coupons?page=${o}`;V.get(e).then(u=>{console.log(u.data);const{coupons:p,pagination:s}=u.data,l=p.map(n=>({...n,is_enabled:!!n.is_enabled}));this.couponList=l,this.pagination=s,console.log(this.couponList)})}}});var j={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:v,VITE_APP_PATH:g}=j,$={props:{currentCoupon:Object,isNew:Boolean},data(){return{couponModal:null,tempCoupon:{},inputDisabled:!0,startDateTimestamp:null,dueDateTimestamp:null}},created(){this.tempCoupon={...this.currentCoupon}},watch:{currentCoupon:{deep:!0,handler(o){this.tempCoupon=o}}},mounted(){this.couponModal=new R(document.querySelector("#couponModal"),{keyboard:!1,backdrop:"static"})},methods:{...D(b,["getCoupons"]),formatDate(o){const{formattedDate:e}=T(o);return{formattedDate:e}},validateDateInput(){const o=Math.floor(Date.parse(this.tempCoupon.start_date)/1e3),e=Math.floor(Date.parse(this.tempCoupon.due_date)/1e3);o>e&&h.fire({title:"啟用日不可大於截止日",icon:"info",showConfirmButton:!1,timer:1500}),this.startDateTimestamp=o,this.dueDateTimestamp=e},togglerEdit(){this.inputDisabled=!1},cancelUpdate(){this.inputDisabled=!0},updateCoupon(){let o=`${v}/api/${g}/admin/coupon`,e="post";this.isNew||(o=`${v}/api/${g}/admin/coupon/${this.tempCoupon.id}`,e="put"),this.tempCoupon.start_date=this.startDateTimestamp,this.tempCoupon.due_date=this.dueDateTimestamp;const u=this.tempCoupon.is_enabled?1:0;this.axios[e](o,{data:{...this.tempCoupon,is_enabled:u,percent:parseInt(this.tempCoupon.percent,10)}}).then(p=>{h.fire({title:p.data.message,icon:"success",showConfirmButton:!1,timer:1500}),this.getCoupons()}).then(()=>{this.inputDisabled=!0,this.couponModal.hide()}).catch(p=>{h.fire({title:p,icon:"error",confirmButtonText:"OK"})})}}},a=o=>(k("data-v-7034c0d9"),o=o(),L(),o),z={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},F={class:"modal-dialog modal-lg modal-dialog-centered"},X={class:"modal-content"},q={class:"modal-header bg-dark opacity-75 text-white"},K={class:"modal-title",id:"couponModalLabel"},G=a(()=>t("br",null,null,-1)),J=a(()=>t("i",{class:"bi bi-x-lg"},null,-1)),Q=[J],W={class:"modal-body"},Y={class:"container-fluid"},Z={class:"row mb-5"},tt={class:"border rounded p-2 bg-light"},et={key:0,class:"row mb-2"},ot={class:"col-md-6 d-flex align-items-center gap-3"},st=a(()=>t("label",{for:"dateInput",class:"col-form-label"},"啟用日期：",-1)),nt={class:"col-sm-6"},lt={class:"row mb-2"},at={class:"col-md-6 d-flex align-items-center gap-3"},it=a(()=>t("label",{for:"enabled",class:"col-form-label"},"啟用狀態：",-1)),dt={class:"col-sm-6"},ct=["disabled"],ut=a(()=>t("option",{value:!0}," 已啟用 ",-1)),pt=a(()=>t("option",{value:!1}," 未啟用 ",-1)),rt=[ut,pt],_t={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},mt={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},ht={class:"col-md-6"},bt={class:"row"},ft={class:"col-md-6"},Ct=a(()=>t("h5",null,"優惠卷資訊",-1)),vt={class:"row mb-2"},gt=a(()=>t("label",{for:"title",class:"col-sm-4 col-form-label"},"優惠卷標題：",-1)),wt={class:"col-sm-8"},Dt=["disabled"],Pt={class:"row mb-2"},yt=a(()=>t("label",{for:"code",class:"col-sm-4 col-form-label"},"優惠卷碼：",-1)),Tt={class:"col-sm-8"},Et=["disabled"],It={class:"row mb-2"},xt=a(()=>t("label",{for:"percent",class:"col-sm-4 col-form-label"},"折扣百分比：",-1)),Vt={class:"col-sm-8"},At=["disabled"],kt={class:"col-md-6"},Lt=a(()=>t("h5",null,"修改期限",-1)),Mt={class:"row mb-2"},St=a(()=>t("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"啟用日期：",-1)),Ut={class:"col-sm-8"},Rt=["disabled"],Bt={class:"row mb-2"},Nt=a(()=>t("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"截止日期：",-1)),Ot={class:"col-sm-8"},Ht=["disabled"],jt={class:"modal-footer"};function $t(o,e,u,p,s,l){return d(),c("div",z,[t("div",F,[t("div",X,[t("div",q,[t("h5",K,[t("span",null,"優惠卷ID："+_(s.tempCoupon.id),1),G]),t("button",{onClick:e[0]||(e[0]=(...n)=>l.cancelUpdate&&l.cancelUpdate(...n)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},Q)]),t("div",W,[t("div",Y,[t("div",Z,[t("div",tt,[isNaN(s.tempCoupon.start_date)?y("",!0):(d(),c("div",et,[t("div",ot,[st,t("div",nt,[r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>l.formatDate(s.tempCoupon.start_date).formattedDate=n),disabled:"",class:"form-control",type:"text",id:"dateInput"},null,512),[[m,l.formatDate(s.tempCoupon.start_date).formattedDate]])])])])),t("div",lt,[t("div",at,[it,t("div",dt,[r(t("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>s.tempCoupon.is_enabled=n),disabled:s.inputDisabled,class:"form-select w-100",id:"enabled"},rt,8,ct),[[A,s.tempCoupon.is_enabled]])]),s.tempCoupon.is_enabled?(d(),c("i",_t)):(d(),c("i",mt))]),t("div",ht,[t("button",{onClick:e[3]||(e[3]=(...n)=>l.togglerEdit&&l.togglerEdit(...n)),type:"button",class:"btn btn-warning"},"修改優惠卷")])])])]),t("div",bt,[t("div",ft,[Ct,t("form",null,[t("div",vt,[gt,t("div",wt,[r(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>s.tempCoupon.title=n),disabled:s.inputDisabled,type:"text",class:"form-control",id:"title"},null,8,Dt),[[m,s.tempCoupon.title,void 0,{lazy:!0}]])])]),t("div",Pt,[yt,t("div",Tt,[r(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>s.tempCoupon.code=n),disabled:s.inputDisabled,type:"text",class:"form-control",id:"code"},null,8,Et),[[m,s.tempCoupon.code,void 0,{lazy:!0}]])])]),t("div",It,[xt,t("div",Vt,[r(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>s.tempCoupon.percent=n),disabled:s.inputDisabled,type:"text",class:"form-control",id:"percent"},null,8,At),[[m,s.tempCoupon.percent,void 0,{lazy:!0}]])])])])]),t("div",kt,[Lt,t("form",null,[t("div",Mt,[St,t("div",Ut,[r(t("input",{onChange:e[7]||(e[7]=(...n)=>l.validateDateInput&&l.validateDateInput(...n)),"onUpdate:modelValue":e[8]||(e[8]=n=>s.tempCoupon.start_date=n),disabled:s.inputDisabled,class:"form-control",type:"date",id:"dateInput"},null,40,Rt),[[m,s.tempCoupon.start_date]])])]),t("div",Bt,[Nt,t("div",Ot,[r(t("input",{onChange:e[9]||(e[9]=(...n)=>l.validateDateInput&&l.validateDateInput(...n)),"onUpdate:modelValue":e[10]||(e[10]=n=>s.tempCoupon.due_date=n),disabled:s.inputDisabled,class:"form-control",type:"date",id:"dateInput"},null,40,Ht),[[m,s.tempCoupon.due_date]])])])])])])])]),t("div",jt,[t("button",{onClick:e[11]||(e[11]=(...n)=>l.cancelUpdate&&l.cancelUpdate(...n)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{onClick:e[12]||(e[12]=(...n)=>l.updateCoupon&&l.updateCoupon(...n)),type:"button",class:"btn btn-danger"}," 確認 ")])])])])}const zt=P($,[["render",$t],["__scopeId","data-v-7034c0d9"]]);var Ft={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:w,VITE_APP_PATH:Xt}=Ft,qt={components:{CouponModal:zt,Pagination:B},data(){return{title:"訂單列表",tempCouponList:[],selectedCoupon:{},isNew:!1}},created(){this.tempCouponList=[...this.couponList]},watch:{couponList:{deep:!0,handler(o){this.tempCouponList=o}}},computed:{...M(b,["couponList","pagination"])},mounted(){this.getCoupons()},methods:{...D(b,["getCoupons"]),formatDate(o){const{formattedDate:e}=T(o);return e},openModal(o,e){o==="new"?(this.selectedCoupon={},this.isNew=!0,this.$refs.couponModal.couponModal.show()):o==="edit"&&(this.selectedCoupon={...e},this.isNew=!1,this.$refs.couponModal.couponModal.show())},deleteCoupon(o){const e=`${w}/api/${Xt}/admin/coupon/${o}`;this.axios.delete(e).then(u=>{h.fire({title:u.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.getCoupons()})},logout(){const o=`${w}/logout`;this.axios.post(o).then(e=>{h.fire({title:e.data.message,icon:"success",showConfirmButton:!1,timer:1500}).then(()=>{document.cookie="myToken=; expires=;",this.axios.defaults.headers.common.Authorization=null,this.$router.push({name:"login"})})})}}},Kt={class:"container"},Gt={class:"row py-2"},Jt={class:"col mt-4 mb-4"},Qt={class:"container py-2"},Wt=t("h2",null,"這是優惠卷頁面",-1),Yt={class:"d-flex justify-content-between gap-2 py-2"},Zt={class:"p-2 mb-0"},te={class:"d-flex justify-content-end gap-2"},ee={class:"container"},oe={class:"table table-hover"},se=t("thead",{class:"table-dark"},[t("tr",null,[t("th",{scope:"col",class:"fw-bold"},"優惠卷標題"),t("th",{scope:"col",class:"fw-bold"},"優惠碼"),t("th",{scope:"col",class:"fw-bold"},"折扣"),t("th",{scope:"col",class:"fw-bold"},"起始日"),t("th",{scope:"col",class:"fw-bold"},"截止日"),t("th",{scope:"col",class:"fw-bold"},"啟用狀態"),t("th")])],-1),ne={key:0},le=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何優惠卷 ")],-1),ae=[le],ie={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},de={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},ce={class:"btn-group",role:"group","aria-label":"Basic outlined example"},ue=["onClick"],pe=["onClick"];function re(o,e,u,p,s,l){const n=f("coupon-modal"),E=f("Pagination");return d(),c("main",Kt,[t("div",Gt,[t("main",Jt,[t("div",Qt,[Wt,t("div",Yt,[t("p",Zt,_(`一頁顯示 ${Object.keys(this.tempCouponList).length} 項商品`),1),t("div",te,[t("button",{onClick:e[0]||(e[0]=i=>l.openModal("new")),type:"button",class:"btn btn-danger"}," 新增優惠卷 "),t("button",{onClick:e[1]||(e[1]=(...i)=>l.logout&&l.logout(...i)),type:"button",class:"btn btn-warning"}," 登出 ")]),C(n,{ref:"couponModal",currentCoupon:s.selectedCoupon,"is-new":s.isNew},null,8,["currentCoupon","is-new"])])]),t("div",ee,[t("table",oe,[se,t("tbody",null,[s.tempCouponList?y("",!0):(d(),c("tr",ne,ae)),(d(!0),c(S,null,U(s.tempCouponList,i=>(d(),c("tr",{key:i.title},[t("td",null,_(i.title),1),t("td",null,_(i.code),1),t("td",null,_(i.percent),1),t("td",null,_(l.formatDate(i.start_date)),1),t("td",null,_(l.formatDate(i.due_date)),1),t("td",null,[i.is_enabled?(d(),c("i",ie)):(d(),c("i",de))]),t("td",null,[t("div",ce,[t("button",{onClick:I=>l.openModal("edit",i),type:"button",class:"btn btn-outline-primary btn-sm"}," 編輯 ",8,ue),t("button",{onClick:I=>l.deleteCoupon(i.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,pe)])])]))),128))])])]),C(E,{pages:o.pagination,onShowPage:o.getCoupons},null,8,["pages","onShowPage"])])])])}const be=P(qt,[["render",re]]);export{be as default};
