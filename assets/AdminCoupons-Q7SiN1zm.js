import{q as D,S as h,_ as y,o as d,c,a as t,t as p,y as u,I as r,C as P,z as k,D as E,E as V,m as M,r as f,b as C,F as A,s as L}from"./index-xEOnfpOF.js";import{c as b}from"./couponsStore-SBU-YzMq.js";import{t as T}from"./timestampToDate-lwWXufjj.js";import{M as U,P as S}from"./Pagination-YNZOTnrG.js";var B={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:v,VITE_APP_PATH:g}=B,N={props:{currentCoupon:Object,isNew:Boolean},data(){return{couponModal:null,tempCoupon:{},inputDisabled:!0,startDateTimestamp:null,dueDateTimestamp:null}},created(){this.tempCoupon={...this.currentCoupon}},watch:{currentCoupon:{deep:!0,handler(o){this.tempCoupon=o}}},mounted(){this.couponModal=new U(document.querySelector("#couponModal"),{keyboard:!1,backdrop:"static"})},methods:{...D(b,["getCoupons"]),formatDate(o){const{formattedDate:e}=T(o);return{formattedDate:e}},validateDateInput(){const o=Math.floor(Date.parse(this.tempCoupon.start_date)/1e3),e=Math.floor(Date.parse(this.tempCoupon.due_date)/1e3);o>e&&h.fire({title:"啟用日不可大於截止日",icon:"info",showConfirmButton:!1,timer:1500}),this.startDateTimestamp=o,this.dueDateTimestamp=e},togglerEdit(){this.inputDisabled=!1},cancelUpdate(){this.inputDisabled=!0},updateCoupon(){let o=`${v}/api/${g}/admin/coupon`,e="post";this.isNew||(o=`${v}/api/${g}/admin/coupon/${this.tempCoupon.id}`,e="put"),this.tempCoupon.start_date=this.startDateTimestamp,this.tempCoupon.due_date=this.dueDateTimestamp;const _=this.tempCoupon.is_enabled?1:0;this.axios[e](o,{data:{...this.tempCoupon,is_enabled:_,percent:parseInt(this.tempCoupon.percent,10)}}).then(m=>{h.fire({title:m.data.message,icon:"success",showConfirmButton:!1,timer:1500}),this.getCoupons()}).then(()=>{this.inputDisabled=!0,this.couponModal.hide()}).catch(m=>{h.fire({title:m,icon:"error",confirmButtonText:"OK"})})}}},i=o=>(E("data-v-7034c0d9"),o=o(),V(),o),R={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},O={class:"modal-dialog modal-lg modal-dialog-centered"},j={class:"modal-content"},z={class:"modal-header bg-dark opacity-75 text-white"},H={class:"modal-title",id:"couponModalLabel"},q=i(()=>t("br",null,null,-1)),F=i(()=>t("i",{class:"bi bi-x-lg"},null,-1)),X=[F],K={class:"modal-body"},G={class:"container-fluid"},J={class:"row mb-5"},Q={class:"border rounded p-2 bg-light"},W={key:0,class:"row mb-2"},Y={class:"col-md-6 d-flex align-items-center gap-3"},Z=i(()=>t("label",{for:"dateInput",class:"col-form-label"},"啟用日期：",-1)),$={class:"col-sm-6"},tt={class:"row mb-2"},et={class:"col-md-6 d-flex align-items-center gap-3"},ot=i(()=>t("label",{for:"enabled",class:"col-form-label"},"啟用狀態：",-1)),st={class:"col-sm-6"},nt=["disabled"],lt=i(()=>t("option",{value:!0}," 已啟用 ",-1)),it=i(()=>t("option",{value:!1}," 未啟用 ",-1)),at=[lt,it],dt={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},ct={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},ut={class:"col-md-6"},pt={class:"row"},rt={class:"col-md-6"},_t=i(()=>t("h5",null,"優惠卷資訊",-1)),mt={class:"row mb-2"},ht=i(()=>t("label",{for:"title",class:"col-sm-4 col-form-label"},"優惠卷標題：",-1)),bt={class:"col-sm-8"},ft=["disabled"],Ct={class:"row mb-2"},vt=i(()=>t("label",{for:"code",class:"col-sm-4 col-form-label"},"優惠卷碼：",-1)),gt={class:"col-sm-8"},wt=["disabled"],Dt={class:"row mb-2"},yt=i(()=>t("label",{for:"percent",class:"col-sm-4 col-form-label"},"折扣百分比：",-1)),Pt={class:"col-sm-8"},Tt=["disabled"],xt={class:"col-md-6"},It=i(()=>t("h5",null,"修改期限",-1)),kt={class:"row mb-2"},Et=i(()=>t("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"啟用日期：",-1)),Vt={class:"col-sm-8"},Mt=["disabled"],At={class:"row mb-2"},Lt=i(()=>t("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"截止日期：",-1)),Ut={class:"col-sm-8"},St=["disabled"],Bt={class:"modal-footer"};function Nt(o,e,_,m,s,l){return d(),c("div",R,[t("div",O,[t("div",j,[t("div",z,[t("h5",H,[t("span",null,"優惠卷ID："+p(s.tempCoupon.id),1),q]),t("button",{onClick:e[0]||(e[0]=(...n)=>l.cancelUpdate&&l.cancelUpdate(...n)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},X)]),t("div",K,[t("div",G,[t("div",J,[t("div",Q,[isNaN(s.tempCoupon.start_date)?P("",!0):(d(),c("div",W,[t("div",Y,[Z,t("div",$,[u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>l.formatDate(s.tempCoupon.start_date).formattedDate=n),disabled:"",class:"form-control",type:"text",id:"dateInput"},null,512),[[r,l.formatDate(s.tempCoupon.start_date).formattedDate]])])])])),t("div",tt,[t("div",et,[ot,t("div",st,[u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=n=>s.tempCoupon.is_enabled=n),disabled:s.inputDisabled,class:"form-select w-100",id:"enabled"},at,8,nt),[[k,s.tempCoupon.is_enabled]])]),s.tempCoupon.is_enabled?(d(),c("i",dt)):(d(),c("i",ct))]),t("div",ut,[t("button",{onClick:e[3]||(e[3]=(...n)=>l.togglerEdit&&l.togglerEdit(...n)),type:"button",class:"btn btn-warning"},"修改優惠卷")])])])]),t("div",pt,[t("div",rt,[_t,t("form",null,[t("div",mt,[ht,t("div",bt,[u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>s.tempCoupon.title=n),disabled:s.inputDisabled,type:"text",class:"form-control",id:"title"},null,8,ft),[[r,s.tempCoupon.title,void 0,{lazy:!0}]])])]),t("div",Ct,[vt,t("div",gt,[u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>s.tempCoupon.code=n),disabled:s.inputDisabled,type:"text",class:"form-control",id:"code"},null,8,wt),[[r,s.tempCoupon.code,void 0,{lazy:!0}]])])]),t("div",Dt,[yt,t("div",Pt,[u(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>s.tempCoupon.percent=n),disabled:s.inputDisabled,type:"text",class:"form-control",id:"percent"},null,8,Tt),[[r,s.tempCoupon.percent,void 0,{lazy:!0}]])])])])]),t("div",xt,[It,t("form",null,[t("div",kt,[Et,t("div",Vt,[u(t("input",{onChange:e[7]||(e[7]=(...n)=>l.validateDateInput&&l.validateDateInput(...n)),"onUpdate:modelValue":e[8]||(e[8]=n=>s.tempCoupon.start_date=n),disabled:s.inputDisabled,class:"form-control",type:"date",id:"dateInput"},null,40,Mt),[[r,s.tempCoupon.start_date]])])]),t("div",At,[Lt,t("div",Ut,[u(t("input",{onChange:e[9]||(e[9]=(...n)=>l.validateDateInput&&l.validateDateInput(...n)),"onUpdate:modelValue":e[10]||(e[10]=n=>s.tempCoupon.due_date=n),disabled:s.inputDisabled,class:"form-control",type:"date",id:"dateInput"},null,40,St),[[r,s.tempCoupon.due_date]])])])])])])])]),t("div",Bt,[t("button",{onClick:e[11]||(e[11]=(...n)=>l.cancelUpdate&&l.cancelUpdate(...n)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{onClick:e[12]||(e[12]=(...n)=>l.updateCoupon&&l.updateCoupon(...n)),type:"button",class:"btn btn-danger"}," 確認 ")])])])])}const Rt=y(N,[["render",Nt],["__scopeId","data-v-7034c0d9"]]);var Ot={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:w,VITE_APP_PATH:jt}=Ot,zt={components:{CouponModal:Rt,Pagination:S},data(){return{title:"訂單列表",tempCouponList:[],selectedCoupon:{},isNew:!1}},created(){this.tempCouponList=[...this.couponList]},watch:{couponList:{deep:!0,handler(o){this.tempCouponList=o}}},computed:{...M(b,["couponList","pagination"])},mounted(){this.getCoupons()},methods:{...D(b,["getCoupons"]),formatDate(o){const{formattedDate:e}=T(o);return e},openModal(o,e){o==="new"?(this.selectedCoupon={},this.isNew=!0,this.$refs.couponModal.couponModal.show()):o==="edit"&&(this.selectedCoupon={...e},this.isNew=!1,this.$refs.couponModal.couponModal.show())},deleteCoupon(o){const e=`${w}/api/${jt}/admin/coupon/${o}`;this.axios.delete(e).then(_=>{h.fire({title:_.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.getCoupons()})},logout(){const o=`${w}/logout`;this.axios.post(o).then(e=>{h.fire({title:e.data.message,icon:"success",showConfirmButton:!1,timer:1500}).then(()=>{document.cookie="myToken=; expires=;",this.axios.defaults.headers.common.Authorization=null,this.$router.push({name:"login"})})})}}},Ht={class:"container"},qt={class:"row py-2"},Ft={class:"col mt-4 mb-4"},Xt={class:"container py-2"},Kt=t("h2",null,"這是優惠卷頁面",-1),Gt={class:"d-flex justify-content-between gap-2 py-2"},Jt={class:"p-2 mb-0"},Qt={class:"d-flex justify-content-end gap-2"},Wt={class:"container"},Yt={class:"table table-hover"},Zt=t("thead",{class:"table-dark"},[t("tr",null,[t("th",{scope:"col",class:"fw-bold"},"優惠卷標題"),t("th",{scope:"col",class:"fw-bold"},"優惠碼"),t("th",{scope:"col",class:"fw-bold"},"折扣"),t("th",{scope:"col",class:"fw-bold"},"起始日"),t("th",{scope:"col",class:"fw-bold"},"截止日"),t("th",{scope:"col",class:"fw-bold"},"啟用狀態"),t("th")])],-1),$t={key:0},te=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何優惠卷 ")],-1),ee=[te],oe={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},se={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},ne={class:"btn-group",role:"group","aria-label":"Basic outlined example"},le=["onClick"],ie=["onClick"];function ae(o,e,_,m,s,l){const n=f("coupon-modal"),x=f("Pagination");return d(),c("main",Ht,[t("div",qt,[t("main",Ft,[t("div",Xt,[Kt,t("div",Gt,[t("p",Jt,p(`一頁顯示 ${Object.keys(this.tempCouponList).length} 項商品`),1),t("div",Qt,[t("button",{onClick:e[0]||(e[0]=a=>l.openModal("new")),type:"button",class:"btn btn-danger"}," 新增優惠卷 "),t("button",{onClick:e[1]||(e[1]=(...a)=>l.logout&&l.logout(...a)),type:"button",class:"btn btn-warning"}," 登出 ")]),C(n,{ref:"couponModal",currentCoupon:s.selectedCoupon,"is-new":s.isNew},null,8,["currentCoupon","is-new"])])]),t("div",Wt,[t("table",Yt,[Zt,t("tbody",null,[s.tempCouponList?P("",!0):(d(),c("tr",$t,ee)),(d(!0),c(A,null,L(s.tempCouponList,a=>(d(),c("tr",{key:a.title},[t("td",null,p(a.title),1),t("td",null,p(a.code),1),t("td",null,p(a.percent),1),t("td",null,p(l.formatDate(a.start_date)),1),t("td",null,p(l.formatDate(a.due_date)),1),t("td",null,[a.is_enabled?(d(),c("i",oe)):(d(),c("i",se))]),t("td",null,[t("div",ne,[t("button",{onClick:I=>l.openModal("edit",a),type:"button",class:"btn btn-outline-primary btn-sm"}," 編輯 ",8,le),t("button",{onClick:I=>l.deleteCoupon(a.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,ie)])])]))),128))])])]),C(x,{pages:o.pagination,onShowPage:o.getCoupons},null,8,["pages","onShowPage"])])])])}const re=y(zt,[["render",ae]]);export{re as default};
