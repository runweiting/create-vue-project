import{v as U,x as B,m as u,q as _,_ as m,o,c as a,y as N,z as V,a as t,F as C,s as k,t as i,A as f,B as b,r as y,b as $,d as w,C as S,D,E as I}from"./index-SQ6S_Pfy.js";import{u as g}from"./userProductsStore-8dkRnAYR.js";import{l as L,c as T}from"./cartStore-DHxjmQ9J.js";import{C as z}from"./CartList-_f7LnEJl.js";import"./couponsStore-lXZ8fVM4.js";const A="https://vue3-course-api.hexschool.io/v2",E="runweiting",v=U("categoryStore",{state:()=>({categoryList:[]}),actions:{getCategory(){const s=`${A}/api/${E}/products/all`;B.get(s).then(n=>{const{products:d}=n.data,l=new Set(d.map(c=>c.category));this.categoryList=[...l]})}}}),F={data(){return{currentCategory:""}},watch:{currentCategory(){this.getProducts(this.currentCategory,1)}},computed:{...u(v,["categoryList"])},methods:{..._(g,["getProducts"])}},M=t("option",{value:""},"全部",-1),j=["value"];function q(s,n,d,l,c,h){return o(),a("div",null,[N(t("select",{"onUpdate:modelValue":n[0]||(n[0]=e=>c.currentCategory=e),class:"form-select form-select-sm"},[M,(o(!0),a(C,null,k(s.categoryList,e=>(o(),a("option",{key:e,value:e},i(e),9,j))),128))],512),[[V,c.currentCategory]])])}const G=m(F,[["render",q]]),Q={computed:{...u(g,["pagination"])},methods:{..._(g,["getProducts"])}},H={class:"px-2"},J={"aria-label":"Page navigation example"},K={class:"pagination"},O=t("span",{"aria-hidden":"true"},"«",-1),R=[O],W={key:0,class:"page-link"},X=["onClick"],Y=t("span",{"aria-hidden":"true"},"»",-1),Z=[Y];function tt(s,n,d,l,c,h){return o(),a("div",H,[t("nav",J,[t("ul",K,[t("li",{class:f([{disabled:s.pagination.current_page===1},"page-item"])},[t("a",{onClick:n[0]||(n[0]=b(e=>s.getProducts(s.pagination.current_page-1),["prevent"])),class:"page-link",href:"#","aria-label":"Previous"},R)],2),(o(!0),a(C,null,k(s.pagination.total_pages,(e,p)=>(o(),a("li",{key:p,class:f([{active:e===s.pagination.current_page},"page-item"])},[e===s.pagination.current_page?(o(),a("span",W,i(e),1)):(o(),a("a",{key:1,onClick:b(r=>s.getProducts(e),["prevent"]),class:"page-link",href:"#"},i(e),9,X))],2))),128)),t("li",{class:f([{disabled:s.pagination.current_page===s.pagination.total_pages},"page-item"])},[t("a",{onClick:n[1]||(n[1]=b(e=>s.getProducts(s.pagination.current_page+1),["prevent"])),class:"page-link",href:"#","aria-label":"Next"},Z)],2)])])])}const st=m(Q,[["render",tt]]),et={components:{CategoryList:G,PaginationGroup:st},data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"runweiting",title:"商品列表",product:{}}},mounted(){this.getProducts(),this.getCategory()},computed:{...u(g,["productList"]),...u(v,["categoryList"]),...u(L,["loadingStatus"])},methods:{..._(g,["getProducts"]),..._(T,["addToCart"]),..._(v,["getCategory"]),async getProduct(s){const n=L();n.loadingStatus.getProduct=s;const d=`${this.apiUrl}/api/${this.apiPath}/product/${s}`;this.$route.params.id=s;try{const l=await this.axios.get(d);this.product=l.data.product,n.loadingStatus.getProduct=""}finally{this.$router.push({name:"productInfo"})}}}},P=s=>(D("data-v-6053f396"),s=s(),I(),s),ot={class:"col-8 mt-4 mb-4",ref:"productList"},at={class:"container d-flex justify-content-between"},nt={class:"p-2 mb-0"},rt={class:"container table-responsive"},it={class:"table table-hover align-middle"},ct={class:"table-secondary"},dt={class:"align-middle",style:{height:"48px"}},lt={scope:"col",style:{width:"17%"}},pt=P(()=>t("th",{scope:"col",class:"fw-bold",style:{width:"30%"}},"商品名稱",-1)),ut=P(()=>t("th",{scope:"col",class:"fw-bold",style:{width:"28%"}},"價格",-1)),_t=P(()=>t("th",{scope:"col",style:{width:"25%"}},null,-1)),gt=["src"],ht={key:0,class:"fs-5 fw-bold mb-0"},yt={key:1},$t={class:"fs-6 fw-bold text-secondary"},mt={class:"fs-5 fw-bold mb-0"},ft={class:"d-flex flex-column gap-2"},bt=["disabled","onClick"],vt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ct=["onClick"],kt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Pt(s,n,d,l,c,h){const e=y("category-list"),p=y("pagination-group");return o(),a("div",ot,[t("div",at,[t("h2",null,i(c.title),1),t("p",nt,i(`目前有 ${s.productList.length} 項商品`),1)]),t("div",rt,[t("table",it,[t("thead",ct,[t("tr",dt,[t("th",lt,[$(e)]),pt,ut,_t])]),t("tbody",null,[(o(!0),a(C,null,k(s.productList,r=>(o(),a("tr",{key:r.title},[t("td",null,[t("img",{src:r.imageUrl,class:"rounded product-img"},null,8,gt)]),t("td",null,i(r.title),1),t("td",null,[r.origin_price===r.price?(o(),a("p",ht,i(r.price)+"元 ",1)):(o(),a("div",yt,[t("del",$t,"原價"+i(r.origin_price)+"元",1),t("p",mt,"現在只要"+i(r.price)+"元",1)]))]),t("td",null,[t("div",ft,[t("button",{disabled:r.id===this.loadingStatus.getProduct,onClick:x=>h.getProduct(r.id),type:"button",class:"btn btn-outline-secondary",id:"modalBtn"},[w(" 查看更多 "),r.id===this.loadingStatus.getProduct?(o(),a("span",vt)):S("",!0)],8,bt),t("button",{onClick:x=>s.addToCart(r.id),type:"button",class:"btn btn-outline-danger"},[w(" 加入購物車 "),r.id===this.loadingStatus.updateQty?(o(),a("span",kt)):S("",!0)],8,Ct)])])]))),128))])]),$(p)])],512)}const wt=m(et,[["render",Pt],["__scopeId","data-v-6053f396"]]),St={components:{ProductList:wt,CartList:z}},Lt={class:"container"},xt=t("h1",{class:"pt-5 text-center"},"商品列表",-1),Ut={class:"row py-2"};function Bt(s,n,d,l,c,h){const e=y("product-list"),p=y("cart-list");return o(),a("main",Lt,[xt,t("div",Ut,[$(e),$(p)])])}const zt=m(St,[["render",Bt]]);export{zt as default};
