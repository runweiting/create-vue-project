import{v as U,x as O,S as h,q as D,_ as P,o as i,c,a as e,t as d,y as _,z as A,I as m,F as E,s as V,C as S,A as T,D as C,E as M,d as g,m as I,r as w,b as k}from"./index-SQ6S_Pfy.js";import{t as L}from"./timestampToDate-lwWXufjj.js";import{M as j,P as R}from"./Pagination-RKM9Efvc.js";var B={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:v,VITE_APP_PATH:y}=B,x=U("orderStore",{state:()=>({orderList:[],pagination:{}}),actions:{getOrders(l=1){const t=`${v}/api/${y}/admin/orders?page=${l}`;O.get(t).then(u=>{const{orders:b,pagination:s}=u.data,n=b.map(o=>({...o,calculateTotal:this.updateTotal(o)}));this.orderList=n,this.pagination=s,console.log(this.orderList)})},updateTotal(l){if(!l||!l.products)return 0;let t=0;return Object.values(l.products).forEach(u=>{t+=u.qty*u.product.price}),t},deleteOrder(l){const t=`${v}/api/${y}/admin/order/${l}`;O.delete(t).then(u=>{h.fire({title:u.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.getOrders()})},deleteOrders(){const l=`${v}/api/${y}/admin/orders/all`;O.delete(l).then(t=>{h.fire({title:t.data.message,icon:"success",showConfirmButton:!1,timer:1500}),this.getOrders()})}}});var q={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:H,VITE_APP_PATH:N}=q,F={props:{currentOrder:Object},data(){return{orderModal:null,tempOrder:{},inputDisabled:!0,subTotal:0}},created(){this.tempOrder={...this.currentOrder,products:{},user:{email:"",name:"",tel:"",address:""}}},watch:{currentOrder:{deep:!0,handler(l){this.tempOrder=l}}},mounted(){this.orderModal=new j(document.querySelector("#orderModal"),{keyboard:!1,backdrop:"static"})},methods:{...D(x,["getOrders","timestampToDate"]),formatDate(l){const{formattedDay:t,formattedDate:u}=L(l);return{formattedDay:t,formattedDate:u}},togglerEdit(){this.inputDisabled=!1,Object.values(this.tempOrder.products).some(t=>t.coupon&&t.coupon.code)?this.subTotal=0:this.updateSubTotal()},updateSubTotal(){let l=0;Object.values(this.tempOrder.products).forEach(t=>{l+=t.qty*t.product.price}),this.subTotal=l},cancelUpdateOrder(){this.subTotal=0,this.inputDisabled=!0},updateOrder(){const l=`${H}/api/${N}/admin/order/${this.tempOrder.id}`;this.axios.put(l,{data:this.tempOrder}).then(t=>{h.fire({title:t.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.subTotal=0,this.inputDisabled=!0,this.orderModal.hide(),this.getOrders()}).catch(t=>{h.fire({title:t.response.data.message,icon:"error",confirmButtonText:"OK"})})}}},r=l=>(C("data-v-aca54e2c"),l=l(),M(),l),z={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},X={class:"modal-dialog modal-xl modal-dialog-centered"},K={class:"modal-content"},G={class:"modal-header bg-dark opacity-75 text-white"},J={class:"modal-title",id:"orderModalLabel"},Q=r(()=>e("br",null,null,-1)),W=r(()=>e("i",{class:"bi bi-x-lg"},null,-1)),Y=[W],Z={class:"modal-body"},$={class:"container-fluid"},ee={class:"row mb-5"},te={class:"border rounded p-2 bg-light"},se={class:"row mb-2"},oe={class:"col-md-5 d-flex align-items-center gap-3"},le=r(()=>e("label",{for:"payment",class:"col-form-label"},"付款狀態：",-1)),de=["disabled"],re=r(()=>e("option",{value:!0}," 已付款 ",-1)),ne=r(()=>e("option",{value:!1}," 未付款 ",-1)),ae=[re,ne],ie={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},ce={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},ue={class:"col-md-7"},_e={class:"row"},pe={class:"col-md-5"},me=r(()=>e("h5",null,"訂購資訊",-1)),he={class:"row mb-2"},be=r(()=>e("label",{for:"date",class:"col-sm-3 col-form-label"},"建立時間：",-1)),fe={class:"col-sm-9"},Oe=["disabled"],ge={class:"row mb-2"},ve=r(()=>e("label",{for:"Email",class:"col-sm-3 col-form-label"},"Email：",-1)),ye={class:"col-sm-9"},Te=["disabled"],xe={class:"row mb-2"},we=r(()=>e("label",{for:"name",class:"col-sm-3 col-form-label"},"收件姓名：",-1)),ke={class:"col-sm-9"},De=["disabled"],Pe={class:"row mb-2"},Ee=r(()=>e("label",{for:"tel",class:"col-sm-3 col-form-label"},"聯絡電話：",-1)),Ve={class:"col-sm-9"},Se=["disabled"],Le={class:"row mb-2"},Ue=r(()=>e("label",{for:"address",class:"col-sm-3 col-form-label"},"收件地址：",-1)),Ae={class:"col-sm-9"},Ce=["disabled"],Me={class:"row mb-2"},Ie=r(()=>e("label",{for:"note",class:"col-sm-3 col-form-label"},"留言：",-1)),je={class:"col-sm-9"},Re=["disabled"],Be={class:"col-md-7"},qe=r(()=>e("div",{class:"container"},[e("div",{class:"d-flex justify-content-between"},[e("h5",null,"商品內容")])],-1)),He={class:"container table-responsive"},Ne={class:"table table-hover align-middle"},Fe=r(()=>e("thead",{class:"table-warning"},[e("tr",{class:"align-middle",style:{height:"48px"}},[e("th",{scope:"col",class:"fw-bold",style:{width:"60%"}},"商品"),e("th",{scope:"col",class:"fw-bold",style:{width:"20%"}},"數量"),e("th",{scope:"col",class:"fw-bold text-end",style:{width:"15%"}},"單價"),e("th",{style:{width:"5%"}})])],-1)),ze={class:"d-flex align-items-center gap-2"},Xe=["src"],Ke=r(()=>e("br",null,null,-1)),Ge={key:0,class:"text-danger"},Je={class:"pe-0"},Qe={class:"d-flex justify-content-between align-items-center"},We={class:"input-group input-group-sm"},Ye=["onUpdate:modelValue","disabled"],Ze={class:"input-group-text"},$e={class:"text-end"},et={class:"fs-6 mb-0"},tt={class:"text-end p-0"},st=["disabled"],ot=r(()=>e("td",null,[g(" 原始金額： "),e("br"),g(" 更新金額： "),e("br"),g(" 折扣金額： ")],-1)),lt={class:"text-end text-danger fw-bold"},dt=r(()=>e("br",null,null,-1)),rt=r(()=>e("br",null,null,-1)),nt={key:0},at={key:1,class:"fw-normal text-dark"},it=r(()=>e("td",null,null,-1)),ct={class:"modal-footer"};function ut(l,t,u,b,s,n){return i(),c("div",z,[e("div",X,[e("div",K,[e("div",G,[e("h5",J,[e("span",null,"訂單編號："+d(s.tempOrder.id),1),Q]),e("button",{onClick:t[0]||(t[0]=(...o)=>n.cancelUpdateOrder&&n.cancelUpdateOrder(...o)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},Y)]),e("div",Z,[e("div",$,[e("div",ee,[e("div",te,[e("div",se,[e("div",oe,[le,e("div",null,[_(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.tempOrder.is_paid=o),disabled:s.inputDisabled,class:"form-select",id:"payment"},ae,8,de),[[A,s.tempOrder.is_paid]])]),s.tempOrder.is_paid?(i(),c("i",ie)):(i(),c("i",ce))]),e("div",ue,[e("button",{onClick:t[2]||(t[2]=(...o)=>n.togglerEdit&&n.togglerEdit(...o)),type:"button",class:"btn btn-warning"},"修改訂單")])])])]),e("div",_e,[e("div",pe,[me,e("form",null,[e("div",he,[be,e("div",fe,[_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>n.formatDate(s.tempOrder.create_at).formattedDate=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"date"},null,8,Oe),[[m,n.formatDate(s.tempOrder.create_at).formattedDate]])])]),e("div",ge,[ve,e("div",ye,[_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.tempOrder.user.email=o),disabled:s.inputDisabled,type:"email",class:"form-control",id:"Email"},null,8,Te),[[m,s.tempOrder.user.email]])])]),e("div",xe,[we,e("div",ke,[_(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.tempOrder.user.name=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"name"},null,8,De),[[m,s.tempOrder.user.name]])])]),e("div",Pe,[Ee,e("div",Ve,[_(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.tempOrder.user.tel=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"tel"},null,8,Se),[[m,s.tempOrder.user.tel]])])]),e("div",Le,[Ue,e("div",Ae,[_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.tempOrder.user.address=o),disabled:s.inputDisabled,type:"text",class:"form-control",id:"address"},null,8,Ce),[[m,s.tempOrder.user.address]])])]),e("div",Me,[Ie,e("div",je,[_(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=o=>s.tempOrder.user.message=o),disabled:s.inputDisabled,class:"form-control",name:"note",id:"note",cols:"10",rows:"10",style:{height:"100px"}},null,8,Re),[[m,s.tempOrder.user.message]])])])])]),e("div",Be,[qe,e("div",He,[e("table",Ne,[Fe,e("tbody",null,[(i(!0),c(E,null,V(s.tempOrder.products,o=>(i(),c("tr",{key:o.id},[e("td",ze,[e("img",{src:o.product.imageUrl,class:"rounded order-img"},null,8,Xe),e("div",null,[e("small",null,d(o.product.title),1),Ke,o.coupon?(i(),c("small",Ge,"優惠碼："+d(o.coupon.code)+"、折數："+d(o.coupon.percent)+"%",1)):S("",!0)])]),e("td",Je,[e("div",Qe,[e("div",We,[_(e("input",{"onUpdate:modelValue":p=>o.qty=p,disabled:o.coupon,onClick:t[9]||(t[9]=(...p)=>n.updateSubTotal&&n.updateSubTotal(...p)),type:"number",min:"1",class:"form-control"},null,8,Ye),[[m,o.qty]]),e("span",Ze,d(o.product.unit),1)])])]),e("td",$e,[e("p",et,d(o.product.price)+"元",1)]),e("td",tt,[e("button",{disabled:s.inputDisabled,onClick:t[10]||(t[10]=(...p)=>l.deleteOrder&&l.deleteOrder(...p)),type:"button",class:"btn btn-outline-danger btn-sm py-0",style:{scale:"80%"}}," x ",8,st)])]))),128))]),e("tfoot",null,[e("tr",null,[e("td",null,[e("span",null,d(`總共 ${Object.keys(s.tempOrder.products).length} 項`),1)]),ot,e("td",lt,[e("span",{class:T({"fw-normal":s.subTotal,"text-dark":s.subTotal,"text-decoration-line-through":s.subTotal})},d(s.tempOrder.calculateTotal)+"元 ",3),dt,e("span",{class:T({"fw-normal":!s.subTotal,"text-dark":!s.subTotal,"text-decoration-line-through":!s.subTotal})},d(s.subTotal)+"元 ",3),rt,Object.values(s.tempOrder.products).some(o=>o.coupon)?(i(),c("span",nt,d(Math.round(s.tempOrder.total))+"元 ",1)):(i(),c("span",at,"無優惠碼"))]),it])])])])])])])]),e("div",ct,[e("button",{onClick:t[11]||(t[11]=(...o)=>n.cancelUpdateOrder&&n.cancelUpdateOrder(...o)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{onClick:t[12]||(t[12]=(...o)=>n.updateOrder&&n.updateOrder(...o)),type:"button",class:"btn btn-danger"}," 更新訂單 ")])])])])}const _t=P(F,[["render",ut],["__scopeId","data-v-aca54e2c"]]),pt={components:{OrderModal:_t,Pagination:R},data(){return{title:"訂單列表",tempOrderList:[],selectedOrder:{}}},created(){this.tempOrderList=[...this.orderList]},watch:{orderList:{deep:!0,handler(l){this.tempOrderList=l}}},computed:{...I(x,["orderList","pagination","calculateTotal"])},mounted(){this.getOrders()},methods:{...D(x,["getOrders","deleteOrder","deleteOrders"]),formatDate(l){const{formattedDate:t,formattedTime:u}=L(l);return{formattedDate:t,formattedTime:u}},checkOrder(l){this.selectedOrder={...l},this.$refs.orderModal.orderModal.show()}}},mt={class:"container"},ht={class:"row py-2"},bt={class:"col mt-4 mb-4"},ft={class:"container py-2"},Ot=e("h2",null,"這是訂單頁面",-1),gt={class:"d-flex justify-content-between gap-2 py-2"},vt={class:"p-2 mb-0"},yt={class:"d-flex justify-content-end gap-2"},Tt={class:"container"},xt={class:"table table-hover"},wt=e("thead",{class:"table-dark"},[e("tr",{class:"fw-bold"},[e("th",{scope:"col"},"日期"),e("th",{scope:"col"},"序號"),e("th",{scope:"col"},"訂單編號"),e("th",{scope:"col"},"品項"),e("th",{scope:"col"},"金額"),e("th",{scope:"col"},"優惠卷"),e("th",{scope:"col"},"訂單狀態"),e("th",{scope:"col"},"付款日期"),e("th")])],-1),kt={key:0},Dt=e("td",{colspan:"7"},[e("small",{class:"text-muted"}," 目前沒有任何訂單 ")],-1),Pt=[Dt],Et={class:"d-block"},Vt={class:"text-muted"},St={key:0},Lt={key:1},Ut={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},At={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},Ct=e("td",null,null,-1),Mt={class:"btn-group",role:"group","aria-label":"Basic outlined example"},It=["onClick"],jt=["onClick"];function Rt(l,t,u,b,s,n){const o=w("order-modal"),p=w("Pagination");return i(),c("main",mt,[e("div",ht,[e("main",bt,[e("div",ft,[Ot,e("div",gt,[e("p",vt,d(`一頁顯示 ${Object.keys(this.tempOrderList).length} 項商品`),1),e("div",yt,[e("button",{onClick:t[0]||(t[0]=(...a)=>l.deleteOrders&&l.deleteOrders(...a)),type:"button",class:"btn btn-danger"}," 刪除全部訂單 ")]),k(o,{ref:"orderModal",currentOrder:s.selectedOrder},null,8,["currentOrder"])])]),e("div",Tt,[e("table",xt,[wt,e("tbody",null,[s.tempOrderList?S("",!0):(i(),c("tr",kt,Pt)),(i(!0),c(E,null,V(s.tempOrderList,a=>(i(),c("tr",{key:a.title},[e("td",null,[e("span",Et,d(n.formatDate(a.create_at).formattedDate),1),e("small",Vt,d(n.formatDate(a.create_at).formattedTime),1)]),e("td",null,d(a.num),1),e("td",null,d(a.id),1),e("td",null,d(Object.keys(a.products).length),1),e("td",null,[Object.values(a.products).some(f=>f.coupon)?(i(),c("span",St,d(Math.round(a.total)),1)):(i(),c("span",Lt,d(a.calculateTotal),1))]),e("td",null,[a.calculateTotal!==a.total?(i(),c("i",Ut)):(i(),c("i",At))]),e("td",{class:T({"text-success":a.is_paid,"text-danger":!a.is_paid})},d(a.is_paid?"已付款":"未付款"),3),Ct,e("td",null,[e("div",Mt,[e("button",{onClick:f=>n.checkOrder(a),type:"button",class:"btn btn-outline-primary btn-sm"}," 查看訂單 ",8,It),e("button",{onClick:f=>l.deleteOrder(a.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,jt)])])]))),128))])])]),k(p,{pages:l.pagination,onShowPage:l.getOrders},null,8,["pages","onShowPage"])])])])}const Nt=P(pt,[["render",Rt]]);export{Nt as default};
