import{q as g,_ as D,o as i,c as d,a as t,t as p,y as c,I as u,C as y,z as I,m as M,r as h,b,F as T,s as P}from"./index-sroXMQlE.js";import{c as _}from"./couponsStore-KIDG3-No.js";import{t as w}from"./timestampToDate-lwWXufjj.js";import{m as V,P as L}from"./Pagination-zP4MUd1n.js";import{s as U}from"./showSuccessToast-Kwm6WSw7.js";import{s as f}from"./showErrorToast-Dxbxa5R0.js";var E={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:C,VITE_APP_PATH:v}=E,N={props:{currentCoupon:Object,isNew:Boolean},data(){return{couponModal:null,tempCoupon:{},inputDisabled:!0,startDateTimestamp:null,dueDateTimestamp:null}},mixins:[V],created(){this.tempCoupon={...this.currentCoupon}},watch:{currentCoupon:{deep:!0,handler(l){this.tempCoupon=l}}},methods:{...g(_,["getCoupons"]),formatDate(l){const{formattedDate:e}=w(l);return{formattedDate:e}},validateDateInput(){const l=Math.floor(Date.parse(this.tempCoupon.start_date)/1e3),e=Math.floor(Date.parse(this.tempCoupon.due_date)/1e3);l>e&&f("啟用日不可大於截止日"),this.startDateTimestamp=l,this.dueDateTimestamp=e},togglerEdit(){this.inputDisabled=!1},cancelUpdate(){this.inputDisabled=!0},updateCoupon(){let l=`${C}/api/${v}/admin/coupon`,e="post";this.isNew||(l=`${C}/api/${v}/admin/coupon/${this.tempCoupon.id}`,e="put"),this.tempCoupon.start_date=this.startDateTimestamp,this.tempCoupon.due_date=this.dueDateTimestamp;const m=this.tempCoupon.is_enabled?1:0;this.axios[e](l,{data:{...this.tempCoupon,is_enabled:m,percent:parseInt(this.tempCoupon.percent,10)}}).then(r=>{U(r.data.message),this.getCoupons()}).then(()=>{this.inputDisabled=!0,this.modal.hide()}).catch(r=>{f(r.response.data.message)})}}},S={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true",ref:"modal"},A={class:"modal-dialog modal-lg modal-dialog-centered"},B={class:"modal-content"},j={class:"modal-header bg-dark opacity-75 text-white"},R={class:"modal-title",id:"couponModalLabel"},z=t("br",null,null,-1),O=t("i",{class:"bi bi-x-lg"},null,-1),F=[O],H={class:"modal-body"},q={class:"container-fluid"},X={class:"row mb-5"},G={class:"border rounded p-2 bg-light"},J={key:0,class:"row mb-2"},K={class:"col-md-6 d-flex align-items-center gap-3"},Q=t("label",{for:"dateInput",class:"col-form-label"},"啟用日期：",-1),W={class:"col-sm-6"},Y={class:"row mb-2"},Z={class:"col-md-6 d-flex align-items-center gap-3"},$=t("label",{for:"enabled",class:"col-form-label"},"啟用狀態：",-1),tt={class:"col-sm-6"},et=["disabled"],ot=t("option",{value:!0}," 已啟用 ",-1),st=t("option",{value:!1}," 未啟用 ",-1),lt=[ot,st],nt={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},at={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},it={class:"col-md-6"},dt={class:"row"},ct={class:"col-md-6"},pt=t("h5",null,"優惠卷資訊",-1),ut={class:"row mb-2"},rt=t("label",{for:"title",class:"col-sm-4 col-form-label"},"優惠卷標題：",-1),mt={class:"col-sm-8"},_t=["disabled"],ht={class:"row mb-2"},bt=t("label",{for:"code",class:"col-sm-4 col-form-label"},"優惠卷碼：",-1),ft={class:"col-sm-8"},Ct=["disabled"],vt={class:"row mb-2"},gt=t("label",{for:"percent",class:"col-sm-4 col-form-label"},"折扣百分比：",-1),Dt={class:"col-sm-8"},yt=["disabled"],wt={class:"col-md-6"},xt=t("h5",null,"修改期限",-1),kt={class:"row mb-2"},It=t("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"啟用日期：",-1),Mt={class:"col-sm-8"},Tt=["disabled"],Pt={class:"row mb-2"},Vt=t("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"截止日期：",-1),Lt={class:"col-sm-8"},Ut=["disabled"],Et={class:"modal-footer"};function Nt(l,e,m,r,o,n){return i(),d("div",S,[t("div",A,[t("div",B,[t("div",j,[t("h5",R,[t("span",null,"優惠卷ID："+p(o.tempCoupon.id),1),z]),t("button",{onClick:e[0]||(e[0]=(...s)=>n.cancelUpdate&&n.cancelUpdate(...s)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},F)]),t("div",H,[t("div",q,[t("div",X,[t("div",G,[isNaN(o.tempCoupon.start_date)?y("",!0):(i(),d("div",J,[t("div",K,[Q,t("div",W,[c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>n.formatDate(o.tempCoupon.start_date).formattedDate=s),disabled:"",class:"form-control",type:"text",id:"dateInput"},null,512),[[u,n.formatDate(o.tempCoupon.start_date).formattedDate]])])])])),t("div",Y,[t("div",Z,[$,t("div",tt,[c(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.tempCoupon.is_enabled=s),disabled:o.inputDisabled,class:"form-select w-100",id:"enabled"},lt,8,et),[[I,o.tempCoupon.is_enabled]])]),o.tempCoupon.is_enabled?(i(),d("i",nt)):(i(),d("i",at))]),t("div",it,[t("button",{onClick:e[3]||(e[3]=(...s)=>n.togglerEdit&&n.togglerEdit(...s)),type:"button",class:"btn btn-warning"},"修改優惠卷")])])])]),t("div",dt,[t("div",ct,[pt,t("form",null,[t("div",ut,[rt,t("div",mt,[c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.tempCoupon.title=s),disabled:o.inputDisabled,type:"text",class:"form-control",id:"title"},null,8,_t),[[u,o.tempCoupon.title,void 0,{lazy:!0}]])])]),t("div",ht,[bt,t("div",ft,[c(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.tempCoupon.code=s),disabled:o.inputDisabled,type:"text",class:"form-control",id:"code"},null,8,Ct),[[u,o.tempCoupon.code,void 0,{lazy:!0}]])])]),t("div",vt,[gt,t("div",Dt,[c(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.tempCoupon.percent=s),disabled:o.inputDisabled,type:"text",class:"form-control",id:"percent"},null,8,yt),[[u,o.tempCoupon.percent,void 0,{lazy:!0}]])])])])]),t("div",wt,[xt,t("form",null,[t("div",kt,[It,t("div",Mt,[c(t("input",{onChange:e[7]||(e[7]=(...s)=>n.validateDateInput&&n.validateDateInput(...s)),"onUpdate:modelValue":e[8]||(e[8]=s=>o.tempCoupon.start_date=s),disabled:o.inputDisabled,class:"form-control",type:"date",id:"dateInput"},null,40,Tt),[[u,o.tempCoupon.start_date]])])]),t("div",Pt,[Vt,t("div",Lt,[c(t("input",{onChange:e[9]||(e[9]=(...s)=>n.validateDateInput&&n.validateDateInput(...s)),"onUpdate:modelValue":e[10]||(e[10]=s=>o.tempCoupon.due_date=s),disabled:o.inputDisabled,class:"form-control",type:"date",id:"dateInput"},null,40,Ut),[[u,o.tempCoupon.due_date]])])])])])])])]),t("div",Et,[t("button",{onClick:e[11]||(e[11]=(...s)=>n.cancelUpdate&&n.cancelUpdate(...s)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{onClick:e[12]||(e[12]=(...s)=>n.updateCoupon&&n.updateCoupon(...s)),type:"button",class:"btn btn-danger"}," 確認 ")])])])],512)}const St=D(N,[["render",Nt]]),At={components:{CouponModal:St,Pagination:L},data(){return{title:"訂單列表",tempCouponList:[],selectedCoupon:{},isNew:!1}},created(){this.tempCouponList=[...this.couponList]},watch:{couponList:{deep:!0,handler(l){this.tempCouponList=l}}},computed:{...M(_,["couponList","pagination"])},mounted(){this.getCoupons()},methods:{...g(_,["getCoupons","deleteCoupon"]),formatDate(l){const{formattedDate:e}=w(l);return e},openModal(l,e){l==="new"?(this.selectedCoupon={},this.isNew=!0,this.$refs.couponModal.openModal()):l==="edit"&&(this.selectedCoupon={...e},this.isNew=!1,this.$refs.couponModal.openModal())}}},Bt={class:"container"},jt={class:"row py-2"},Rt={class:"col mt-4 mb-4"},zt={class:"container py-2"},Ot=t("h2",null,"這是優惠卷頁面",-1),Ft={class:"d-flex justify-content-between gap-2 py-2"},Ht={class:"p-2 mb-0"},qt={class:"d-flex justify-content-end gap-2"},Xt={class:"container"},Gt={class:"table table-hover"},Jt=t("thead",{class:"table-dark"},[t("tr",{class:"fw-bold"},[t("th",{scope:"col"},"優惠卷標題"),t("th",{scope:"col"},"優惠碼"),t("th",{scope:"col"},"折扣"),t("th",{scope:"col"},"起始日"),t("th",{scope:"col"},"截止日"),t("th",{scope:"col"},"啟用狀態"),t("th")])],-1),Kt={key:0},Qt=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何優惠卷 ")],-1),Wt=[Qt],Yt={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},Zt={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},$t={class:"btn-group",role:"group","aria-label":"Basic outlined example"},te=["onClick"],ee=["onClick"];function oe(l,e,m,r,o,n){const s=h("coupon-modal"),x=h("Pagination");return i(),d("main",Bt,[t("div",jt,[t("main",Rt,[t("div",zt,[Ot,t("div",Ft,[t("p",Ht,p(`一頁顯示 ${Object.keys(this.tempCouponList).length} 項商品`),1),t("div",qt,[t("button",{onClick:e[0]||(e[0]=a=>n.openModal("new")),type:"button",class:"btn btn-danger"}," 新增優惠卷 ")]),b(s,{ref:"couponModal",currentCoupon:o.selectedCoupon,"is-new":o.isNew},null,8,["currentCoupon","is-new"])])]),t("div",Xt,[t("table",Gt,[Jt,t("tbody",null,[o.tempCouponList?y("",!0):(i(),d("tr",Kt,Wt)),(i(!0),d(T,null,P(o.tempCouponList,a=>(i(),d("tr",{key:a.title},[t("td",null,p(a.title),1),t("td",null,p(a.code),1),t("td",null,p(a.percent),1),t("td",null,p(n.formatDate(a.start_date)),1),t("td",null,p(n.formatDate(a.due_date)),1),t("td",null,[a.is_enabled?(i(),d("i",Yt)):(i(),d("i",Zt))]),t("td",null,[t("div",$t,[t("button",{onClick:k=>n.openModal("edit",a),type:"button",class:"btn btn-outline-primary btn-sm"}," 編輯 ",8,te),t("button",{onClick:k=>l.deleteCoupon(a.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,ee)])])]))),128))])])]),b(x,{pages:l.pagination,onShowPage:l.getCoupons},null,8,["pages","onShowPage"])])])])}const ce=D(At,[["render",oe]]);export{ce as default};
