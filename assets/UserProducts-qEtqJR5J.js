import{e as A,f as T,g as B,m as _,h as u,_ as f,o as a,c as n,i as I,v as Q,a as s,F as $,j as C,t as l,n as v,k as b,S as j,r as g,b as h,d as w,l as L,p as D,q as E}from"./index-h-bKmgwY.js";import{l as x,c as F}from"./cartStore-0qDOXt_8.js";import{p as U}from"./productInfoStore-NpC2utXg.js";import{C as M}from"./CartList-f3lbOiUE.js";const q=A.useLoading({}),z="https://vue3-course-api.hexschool.io/v2",G="runweiting",y=T("productsStore",{state:()=>({productList:[],pagination:{},fullPage:!1}),actions:{async getProducts(t,o=1){const d=q.show();let r=`${z}/api/${G}/products?page=${o}`;t&&(r+=`&category=${t}`);try{const i=await B.get(r),{products:p,pagination:e}=i.data;this.productList=p,this.pagination=e,this.sortProducts()}finally{d.hide()}},sortProducts(){this.productList=this.productList.sort((t,o)=>t.price-o.price)}},getters:{}}),K="https://vue3-course-api.hexschool.io/v2",O="runweiting",P=T("categoryStore",{state:()=>({categoryList:[]}),actions:{getCategory(){const t=`${K}/api/${O}/products/all`;B.get(t).then(o=>{const{products:d}=o.data,r=new Set(d.map(i=>i.category));this.categoryList=[...r]})}}}),H={data(){return{currentCategory:""}},watch:{currentCategory(){this.getProducts(1,this.currentCategory)}},computed:{..._(P,["categoryList"])},methods:{...u(y,["getProducts"])}},J=s("option",{value:""},"全部",-1),R=["value"];function W(t,o,d,r,i,p){return a(),n("div",null,[I(s("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>i.currentCategory=e),class:"form-select form-select-sm"},[J,(a(!0),n($,null,C(t.categoryList,e=>(a(),n("option",{key:e,value:e},l(e),9,R))),128))],512),[[Q,i.currentCategory]])])}const X=f(H,[["render",W]]),Y={computed:{..._(y,["pagination"])},methods:{...u(y,["getProducts"])}},Z={class:"px-2"},tt={"aria-label":"Page navigation example"},st={class:"pagination"},ot=s("span",{"aria-hidden":"true"},"«",-1),et=[ot],at={key:0,class:"page-link"},nt=["onClick"],rt=s("span",{"aria-hidden":"true"},"»",-1),it=[rt];function ct(t,o,d,r,i,p){return a(),n("div",Z,[s("nav",tt,[s("ul",st,[s("li",{class:v([{disabled:t.pagination.current_page===1},"page-item"])},[s("a",{onClick:o[0]||(o[0]=b(e=>t.getProducts(t.pagination.current_page-1),["prevent"])),class:"page-link",href:"#","aria-label":"Previous"},et)],2),(a(!0),n($,null,C(t.pagination.total_pages,(e,m)=>(a(),n("li",{key:m,class:v([{active:e===t.pagination.current_page},"page-item"])},[e===t.pagination.current_page?(a(),n("span",at,l(e),1)):(a(),n("a",{key:1,onClick:b(k=>t.getProducts(e),["prevent"]),class:"page-link",href:"#"},l(e),9,nt))],2))),128)),s("li",{class:v([{disabled:t.pagination.current_page===t.pagination.total_pages},"page-item"])},[s("a",{onClick:o[1]||(o[1]=b(e=>t.getProducts(t.pagination.current_page+1),["prevent"])),class:"page-link",href:"#","aria-label":"Next"},it)],2)])])])}const dt=f(Y,[["render",ct]]),lt={components:{CartList:M,CategoryList:X,PaginationGroup:dt},data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"runweiting",title:"商品列表",product:{},fullPage:!1}},mounted(){this.getProducts(),this.getCart(),this.getCategory()},computed:{..._(y,["productList"]),..._(P,["categoryList"]),..._(x,["loadingStatus"])},methods:{...u(y,["getProducts"]),...u(F,["getCart"]),...u(P,["getCategory"]),...u(U,["setSelectedProduct"]),async getProduct(t){const o=x();o.loadingStatus.getProduct=t;const d=`${this.apiUrl}/api/${this.apiPath}/product/${t}`;this.$route.params.id=t;try{const r=await this.axios.get(d);this.product=r.data.product,console.log(this.product),U().setSelectedProduct(this.product),o.loadingStatus.getProduct="",this.$router.push({name:"productInfo"})}catch(r){console.log(r)}},addToCart(t,o=1){this.loadingStatus.updateQty=t;const d=`${this.apiUrl}/api/${this.apiPath}/cart`,r={product_id:t,qty:o};this.axios.post(d,{data:r}).then(i=>{j.fire({title:i.data.message,icon:"success",confirmButtonText:"OK"}),this.loadingStatus.updateQty="",this.getCart()})}}},S=t=>(D("data-v-358741e4"),t=t(),E(),t),pt={class:"col-8 mt-4 mb-4",ref:"productList"},ut={class:"container d-flex justify-content-between"},gt={class:"p-2 mb-0"},ht={class:"container table-responsive"},_t={class:"table table-hover align-middle"},yt={class:"table-secondary"},$t={class:"align-middle",style:{height:"48px"}},ft={scope:"col",style:{width:"17%"}},mt=S(()=>s("th",{scope:"col",class:"fw-bold",style:{width:"30%"}},"商品名稱",-1)),vt=S(()=>s("th",{scope:"col",class:"fw-bold",style:{width:"28%"}},"價格",-1)),bt=S(()=>s("th",{scope:"col",style:{width:"25%"}},null,-1)),Pt=["src"],Ct={key:0,class:"fs-5 fw-bold mb-0"},St={key:1},kt={class:"fs-6 fw-bold text-secondary"},wt={class:"fs-5 fw-bold mb-0"},Lt={class:"d-flex flex-column gap-2"},xt=["disabled","onClick"],Ut={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Tt=["onClick"],Bt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Nt(t,o,d,r,i,p){const e=g("category-list"),m=g("pagination-group"),k=g("show-modal"),N=g("cart-list");return a(),n($,null,[s("div",pt,[s("div",ut,[s("h2",null,l(i.title),1),s("p",gt,l(`目前有 ${t.productList.length} 項商品`),1)]),s("div",ht,[s("table",_t,[s("thead",yt,[s("tr",$t,[s("th",ft,[h(e)]),mt,vt,bt])]),s("tbody",null,[(a(!0),n($,null,C(t.productList,c=>(a(),n("tr",{key:c.title},[s("td",null,[s("img",{src:c.imageUrl,class:"rounded product-img"},null,8,Pt)]),s("td",null,l(c.title),1),s("td",null,[c.origin_price===c.price?(a(),n("p",Ct,l(c.price)+"元 ",1)):(a(),n("div",St,[s("del",kt,"原價"+l(c.origin_price)+"元",1),s("p",wt,"現在只要"+l(c.price)+"元",1)]))]),s("td",null,[s("div",Lt,[s("button",{disabled:c.id===this.loadingStatus.getProduct,onClick:V=>p.getProduct(c.id),type:"button",class:"btn btn-outline-secondary",id:"modalBtn"},[w(" 查看更多 "),c.id===this.loadingStatus.getProduct?(a(),n("span",Ut)):L("",!0)],8,xt),s("button",{onClick:V=>p.addToCart(c.id),type:"button",class:"btn btn-outline-danger"},[w(" 加入購物車 "),c.id===this.loadingStatus.updateQty?(a(),n("span",Bt)):L("",!0)],8,Tt)])])]))),128))])]),h(m)]),h(k,{onAddToCart:p.addToCart},null,8,["onAddToCart"])],512),h(N,{class:"sticky"})],64)}const Vt=f(lt,[["render",Nt],["__scopeId","data-v-358741e4"]]),At={components:{ProductList:Vt}},It={class:"container"},Qt=s("h1",{class:"pt-5 text-center"},"商品列表",-1),jt={class:"row py-2"};function Dt(t,o,d,r,i,p){const e=g("product-list");return a(),n("main",It,[Qt,s("div",jt,[h(e)])])}const zt=f(At,[["render",Dt]]);export{zt as default};
