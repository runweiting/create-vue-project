import{q as g,S as m,_ as y,o as a,c as d,a as t,t as p,y as c,I as u,C as D,z as M,m as I,r as b,b as f,F as T,s as P}from"./index-SQ6S_Pfy.js";import{c as h}from"./couponsStore-lXZ8fVM4.js";import{t as w}from"./timestampToDate-lwWXufjj.js";import{M as V,P as L}from"./Pagination-RKM9Efvc.js";var U={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:C,VITE_APP_PATH:v}=U,E={props:{currentCoupon:Object,isNew:Boolean},data(){return{couponModal:null,tempCoupon:{},inputDisabled:!0,startDateTimestamp:null,dueDateTimestamp:null}},created(){this.tempCoupon={...this.currentCoupon}},watch:{currentCoupon:{deep:!0,handler(n){this.tempCoupon=n}}},mounted(){this.couponModal=new V(document.querySelector("#couponModal"),{keyboard:!1,backdrop:"static"})},methods:{...g(h,["getCoupons"]),formatDate(n){const{formattedDate:e}=w(n);return{formattedDate:e}},validateDateInput(){const n=Math.floor(Date.parse(this.tempCoupon.start_date)/1e3),e=Math.floor(Date.parse(this.tempCoupon.due_date)/1e3);n>e&&m.fire({title:"啟用日不可大於截止日",icon:"info",showConfirmButton:!1,timer:1500}),this.startDateTimestamp=n,this.dueDateTimestamp=e},togglerEdit(){this.inputDisabled=!1},cancelUpdate(){this.inputDisabled=!0},updateCoupon(){let n=`${C}/api/${v}/admin/coupon`,e="post";this.isNew||(n=`${C}/api/${v}/admin/coupon/${this.tempCoupon.id}`,e="put"),this.tempCoupon.start_date=this.startDateTimestamp,this.tempCoupon.due_date=this.dueDateTimestamp;const _=this.tempCoupon.is_enabled?1:0;this.axios[e](n,{data:{...this.tempCoupon,is_enabled:_,percent:parseInt(this.tempCoupon.percent,10)}}).then(r=>{m.fire({title:r.data.message,icon:"success",showConfirmButton:!1,timer:1500}),this.getCoupons()}).then(()=>{this.inputDisabled=!0,this.couponModal.hide()}).catch(r=>{m.fire({title:r,icon:"error",confirmButtonText:"OK"})})}}},S={class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},N={class:"modal-dialog modal-lg modal-dialog-centered"},A={class:"modal-content"},B={class:"modal-header bg-dark opacity-75 text-white"},j={class:"modal-title",id:"couponModalLabel"},O=t("br",null,null,-1),R=t("i",{class:"bi bi-x-lg"},null,-1),z=[R],q={class:"modal-body"},F={class:"container-fluid"},H={class:"row mb-5"},K={class:"border rounded p-2 bg-light"},X={key:0,class:"row mb-2"},G={class:"col-md-6 d-flex align-items-center gap-3"},J=t("label",{for:"dateInput",class:"col-form-label"},"啟用日期：",-1),Q={class:"col-sm-6"},W={class:"row mb-2"},Y={class:"col-md-6 d-flex align-items-center gap-3"},Z=t("label",{for:"enabled",class:"col-form-label"},"啟用狀態：",-1),$={class:"col-sm-6"},tt=["disabled"],et=t("option",{value:!0}," 已啟用 ",-1),ot=t("option",{value:!1}," 未啟用 ",-1),st=[et,ot],nt={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},lt={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},it={class:"col-md-6"},at={class:"row"},dt={class:"col-md-6"},ct=t("h5",null,"優惠卷資訊",-1),pt={class:"row mb-2"},ut=t("label",{for:"title",class:"col-sm-4 col-form-label"},"優惠卷標題：",-1),rt={class:"col-sm-8"},_t=["disabled"],mt={class:"row mb-2"},ht=t("label",{for:"code",class:"col-sm-4 col-form-label"},"優惠卷碼：",-1),bt={class:"col-sm-8"},ft=["disabled"],Ct={class:"row mb-2"},vt=t("label",{for:"percent",class:"col-sm-4 col-form-label"},"折扣百分比：",-1),gt={class:"col-sm-8"},yt=["disabled"],Dt={class:"col-md-6"},wt=t("h5",null,"修改期限",-1),kt={class:"row mb-2"},xt=t("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"啟用日期：",-1),Mt={class:"col-sm-8"},It=["disabled"],Tt={class:"row mb-2"},Pt=t("label",{for:"dateInput",class:"col-sm-4 col-form-label"},"截止日期：",-1),Vt={class:"col-sm-8"},Lt=["disabled"],Ut={class:"modal-footer"};function Et(n,e,_,r,o,l){return a(),d("div",S,[t("div",N,[t("div",A,[t("div",B,[t("h5",j,[t("span",null,"優惠卷ID："+p(o.tempCoupon.id),1),O]),t("button",{onClick:e[0]||(e[0]=(...s)=>l.cancelUpdate&&l.cancelUpdate(...s)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},z)]),t("div",q,[t("div",F,[t("div",H,[t("div",K,[isNaN(o.tempCoupon.start_date)?D("",!0):(a(),d("div",X,[t("div",G,[J,t("div",Q,[c(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.formatDate(o.tempCoupon.start_date).formattedDate=s),disabled:"",class:"form-control",type:"text",id:"dateInput"},null,512),[[u,l.formatDate(o.tempCoupon.start_date).formattedDate]])])])])),t("div",W,[t("div",Y,[Z,t("div",$,[c(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.tempCoupon.is_enabled=s),disabled:o.inputDisabled,class:"form-select w-100",id:"enabled"},st,8,tt),[[M,o.tempCoupon.is_enabled]])]),o.tempCoupon.is_enabled?(a(),d("i",nt)):(a(),d("i",lt))]),t("div",it,[t("button",{onClick:e[3]||(e[3]=(...s)=>l.togglerEdit&&l.togglerEdit(...s)),type:"button",class:"btn btn-warning"},"修改優惠卷")])])])]),t("div",at,[t("div",dt,[ct,t("form",null,[t("div",pt,[ut,t("div",rt,[c(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>o.tempCoupon.title=s),disabled:o.inputDisabled,type:"text",class:"form-control",id:"title"},null,8,_t),[[u,o.tempCoupon.title,void 0,{lazy:!0}]])])]),t("div",mt,[ht,t("div",bt,[c(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>o.tempCoupon.code=s),disabled:o.inputDisabled,type:"text",class:"form-control",id:"code"},null,8,ft),[[u,o.tempCoupon.code,void 0,{lazy:!0}]])])]),t("div",Ct,[vt,t("div",gt,[c(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>o.tempCoupon.percent=s),disabled:o.inputDisabled,type:"text",class:"form-control",id:"percent"},null,8,yt),[[u,o.tempCoupon.percent,void 0,{lazy:!0}]])])])])]),t("div",Dt,[wt,t("form",null,[t("div",kt,[xt,t("div",Mt,[c(t("input",{onChange:e[7]||(e[7]=(...s)=>l.validateDateInput&&l.validateDateInput(...s)),"onUpdate:modelValue":e[8]||(e[8]=s=>o.tempCoupon.start_date=s),disabled:o.inputDisabled,class:"form-control",type:"date",id:"dateInput"},null,40,It),[[u,o.tempCoupon.start_date]])])]),t("div",Tt,[Pt,t("div",Vt,[c(t("input",{onChange:e[9]||(e[9]=(...s)=>l.validateDateInput&&l.validateDateInput(...s)),"onUpdate:modelValue":e[10]||(e[10]=s=>o.tempCoupon.due_date=s),disabled:o.inputDisabled,class:"form-control",type:"date",id:"dateInput"},null,40,Lt),[[u,o.tempCoupon.due_date]])])])])])])])]),t("div",Ut,[t("button",{onClick:e[11]||(e[11]=(...s)=>l.cancelUpdate&&l.cancelUpdate(...s)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{onClick:e[12]||(e[12]=(...s)=>l.updateCoupon&&l.updateCoupon(...s)),type:"button",class:"btn btn-danger"}," 確認 ")])])])])}const St=y(E,[["render",Et]]),Nt={components:{CouponModal:St,Pagination:L},data(){return{title:"訂單列表",tempCouponList:[],selectedCoupon:{},isNew:!1}},created(){this.tempCouponList=[...this.couponList]},watch:{couponList:{deep:!0,handler(n){this.tempCouponList=n}}},computed:{...I(h,["couponList","pagination"])},mounted(){this.getCoupons()},methods:{...g(h,["getCoupons","deleteCoupon"]),formatDate(n){const{formattedDate:e}=w(n);return e},openModal(n,e){n==="new"?(this.selectedCoupon={},this.isNew=!0,this.$refs.couponModal.couponModal.show()):n==="edit"&&(this.selectedCoupon={...e},this.isNew=!1,this.$refs.couponModal.couponModal.show())}}},At={class:"container"},Bt={class:"row py-2"},jt={class:"col mt-4 mb-4"},Ot={class:"container py-2"},Rt=t("h2",null,"這是優惠卷頁面",-1),zt={class:"d-flex justify-content-between gap-2 py-2"},qt={class:"p-2 mb-0"},Ft={class:"d-flex justify-content-end gap-2"},Ht={class:"container"},Kt={class:"table table-hover"},Xt=t("thead",{class:"table-dark"},[t("tr",{class:"fw-bold"},[t("th",{scope:"col"},"優惠卷標題"),t("th",{scope:"col"},"優惠碼"),t("th",{scope:"col"},"折扣"),t("th",{scope:"col"},"起始日"),t("th",{scope:"col"},"截止日"),t("th",{scope:"col"},"啟用狀態"),t("th")])],-1),Gt={key:0},Jt=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何優惠卷 ")],-1),Qt=[Jt],Wt={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},Yt={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},Zt={class:"btn-group",role:"group","aria-label":"Basic outlined example"},$t=["onClick"],te=["onClick"];function ee(n,e,_,r,o,l){const s=b("coupon-modal"),k=b("Pagination");return a(),d("main",At,[t("div",Bt,[t("main",jt,[t("div",Ot,[Rt,t("div",zt,[t("p",qt,p(`一頁顯示 ${Object.keys(this.tempCouponList).length} 項商品`),1),t("div",Ft,[t("button",{onClick:e[0]||(e[0]=i=>l.openModal("new")),type:"button",class:"btn btn-danger"}," 新增優惠卷 ")]),f(s,{ref:"couponModal",currentCoupon:o.selectedCoupon,"is-new":o.isNew},null,8,["currentCoupon","is-new"])])]),t("div",Ht,[t("table",Kt,[Xt,t("tbody",null,[o.tempCouponList?D("",!0):(a(),d("tr",Gt,Qt)),(a(!0),d(T,null,P(o.tempCouponList,i=>(a(),d("tr",{key:i.title},[t("td",null,p(i.title),1),t("td",null,p(i.code),1),t("td",null,p(i.percent),1),t("td",null,p(l.formatDate(i.start_date)),1),t("td",null,p(l.formatDate(i.due_date)),1),t("td",null,[i.is_enabled?(a(),d("i",Wt)):(a(),d("i",Yt))]),t("td",null,[t("div",Zt,[t("button",{onClick:x=>l.openModal("edit",i),type:"button",class:"btn btn-outline-primary btn-sm"}," 編輯 ",8,$t),t("button",{onClick:x=>n.deleteCoupon(i.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,te)])])]))),128))])])]),f(k,{pages:n.pagination,onShowPage:n.getCoupons},null,8,["pages","onShowPage"])])])])}const ie=y(Nt,[["render",ee]]);export{ie as default};
