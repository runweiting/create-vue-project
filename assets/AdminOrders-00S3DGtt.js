import{v as A,x as L,q as x,S as b,_ as E,o as u,c as _,a as t,t as a,y as p,z as U,I as h,F as D,s as V,A as O,D as I,E as S,d as v,m as C,r as y,b as w,C as M}from"./index-V8okAGTS.js";import{M as R,P as j}from"./Pagination-_FUdxpwu.js";var B={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:$,VITE_APP_PATH:H}=B,T=A("orderStore",{state:()=>({orderList:[],pagination:{}}),actions:{getOrders(o=1){const e=`${$}/api/${H}/admin/orders?page=${o}`;L.get(e).then(i=>{const{orders:m,pagination:s}=i.data,d=m.map(l=>({...l,calculateTotal:this.updateTotal(l)}));this.orderList=d,this.pagination=s,console.log("orders",typeof m,this.orders),console.log("orderList",typeof this.orderList,this.orderList)})},updateTotal(o){if(!o||!o.products)return 0;let e=0;return Object.values(o.products).forEach(i=>{e+=i.qty*i.product.price}),e},timestampToDate(o){const e=new Date(o*1e3),i=e.getFullYear(),m=e.getMonth()+1,s=e.getDate(),d=e.getHours(),l=e.getMinutes(),c=e.getSeconds(),r=`${i}/${m}/${s}`,f=`${d}:${l}:${c}`,k=`${i}/${m}/${s} ${d}:${l}:${c}`;return{formattedDate:r,formattedTime:f,formattedDay:k}}}});var q={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:F,VITE_APP_PATH:N}=q,z={props:{currentOrder:Object},data(){return{orderModal:null,tempOrder:{},inputDisabled:!0,subTotal:0}},created(){this.tempOrder={...this.currentOrder,products:{},user:{email:"",name:"",tel:"",address:""}}},watch:{currentOrder:{deep:!0,handler(o){this.tempOrder=o}}},mounted(){this.orderModal=new R(document.querySelector("#orderModal"),{keyboard:!1,backdrop:"static"}),console.log(this.tempOrder)},methods:{...x(T,["getOrders","timestampToDate"]),togglerEdit(){this.inputDisabled=!1,this.updateTotal()},updateTotal(){this.subTotal=this.tempOrder.calculateTotal;let o=0;Object.values(this.tempOrder.products).forEach(e=>{o+=e.qty*e.product.price}),this.subTotal=o},cancelUpdateOrder(){this.subTotal=0,this.inputDisabled=!0},updateOrder(){const o=`${F}/api/${N}/admin/order/${this.tempOrder.id}`;this.axios.put(o,{data:this.tempOrder}).then(e=>{b.fire({title:e.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.subTotal=0,this.inputDisabled=!0,this.orderModal.hide(),this.getOrders(),this.tempOrder=[...this.currentOrder]}).catch(e=>{b.fire({title:e.response.data.message,icon:"error",confirmButtonText:"OK"})})}}},n=o=>(I("data-v-934aa33c"),o=o(),S(),o),X={class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},K={class:"modal-dialog modal-xl modal-dialog-centered"},Y={class:"modal-content"},G={class:"modal-header bg-dark opacity-75 text-white"},J={class:"modal-title",id:"orderModalLabel"},Q=n(()=>t("br",null,null,-1)),W=n(()=>t("i",{class:"bi bi-x-lg"},null,-1)),Z=[W],tt={class:"modal-body"},et={class:"container-fluid"},st={class:"row mb-5"},ot={class:"border rounded p-2 bg-light"},lt={class:"row mb-2"},dt={class:"col-md-5 d-flex align-items-center gap-3"},rt=n(()=>t("label",{for:"payment",class:"col-form-label"},"付款狀態：",-1)),nt=["disabled"],at=n(()=>t("option",{value:!0}," 已付款 ",-1)),it=n(()=>t("option",{value:!1}," 未付款 ",-1)),ct=[at,it],ut={key:0,class:"bi bi-check-circle-fill text-success",style:{scale:"150%"}},_t={key:1,class:"bi bi-x-circle-fill text-danger",style:{scale:"150%"}},pt={class:"col-md-7"},mt={class:"row"},ht={class:"col-md-5"},bt=n(()=>t("h5",null,"訂購資訊",-1)),ft={class:"row mb-2"},gt=n(()=>t("label",{for:"date",class:"col-sm-3 col-form-label"},"建立時間：",-1)),Ot={class:"col-sm-9"},Tt=["disabled"],vt={class:"row mb-2"},yt=n(()=>t("label",{for:"Email",class:"col-sm-3 col-form-label"},"Email：",-1)),wt={class:"col-sm-9"},Pt=["disabled"],xt={class:"row mb-2"},Et=n(()=>t("label",{for:"name",class:"col-sm-3 col-form-label"},"收件姓名：",-1)),Dt={class:"col-sm-9"},Vt=["disabled"],kt={class:"row mb-2"},At=n(()=>t("label",{for:"tel",class:"col-sm-3 col-form-label"},"聯絡電話：",-1)),Lt={class:"col-sm-9"},Ut=["disabled"],It={class:"row mb-2"},St=n(()=>t("label",{for:"address",class:"col-sm-3 col-form-label"},"收件地址：",-1)),Ct={class:"col-sm-9"},Mt=["disabled"],Rt={class:"row mb-2"},jt=n(()=>t("label",{for:"note",class:"col-sm-3 col-form-label"},"留言：",-1)),Bt={class:"col-sm-9"},$t=["disabled"],Ht={class:"col-md-7"},qt=n(()=>t("div",{class:"container"},[t("div",{class:"d-flex justify-content-between"},[t("h5",null,"商品內容"),t("span",{class:"fs-6 text-danger"},"優惠碼：")])],-1)),Ft={class:"container table-responsive"},Nt={class:"table table-hover align-middle"},zt=n(()=>t("thead",{class:"table-warning"},[t("tr",{class:"align-middle",style:{height:"48px"}},[t("th",{scope:"col",class:"fw-bold",style:{width:"60%"}},"商品"),t("th",{scope:"col",class:"fw-bold",style:{width:"20%"}},"數量"),t("th",{scope:"col",class:"fw-bold text-end",style:{width:"15%"}},"單價"),t("th",{style:{width:"5%"}})])],-1)),Xt={class:"d-flex align-items-center gap-1"},Kt=["src"],Yt={class:"pe-0"},Gt={class:"d-flex justify-content-between align-items-center"},Jt={class:"input-group input-group-sm"},Qt=["onUpdate:modelValue","disabled"],Wt={class:"input-group-text"},Zt={class:"text-end"},te={class:"fs-6 mb-0"},ee={class:"text-end p-0"},se=["disabled"],oe=n(()=>t("td",null,[v(" 原始金額： "),t("br"),v(" 更新金額： ")],-1)),le={class:"text-end fs-5 text-danger fw-bold"},de=n(()=>t("br",null,null,-1)),re=n(()=>t("td",null,null,-1)),ne={class:"modal-footer"};function ae(o,e,i,m,s,d){return u(),_("div",X,[t("div",K,[t("div",Y,[t("div",G,[t("h5",J,[t("span",null,"訂單編號："+a(s.tempOrder.id),1),Q]),t("button",{onClick:e[0]||(e[0]=(...l)=>d.cancelUpdateOrder&&d.cancelUpdateOrder(...l)),type:"button",class:"btn btn-outline-light","data-bs-dismiss":"modal","aria-label":"Close"},Z)]),t("div",tt,[t("div",et,[t("div",st,[t("div",ot,[t("div",lt,[t("div",dt,[rt,t("div",null,[p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>s.tempOrder.is_paid=l),disabled:s.inputDisabled,class:"form-select",id:"payment"},ct,8,nt),[[U,s.tempOrder.is_paid]])]),s.tempOrder.is_paid?(u(),_("i",ut)):(u(),_("i",_t))]),t("div",pt,[t("button",{onClick:e[2]||(e[2]=(...l)=>d.togglerEdit&&d.togglerEdit(...l)),type:"button",class:"btn btn-warning"},"修改訂單")])])])]),t("div",mt,[t("div",ht,[bt,t("form",null,[t("div",ft,[gt,t("div",Ot,[p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>o.timestampToDate(s.tempOrder.create_at).formattedDay=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"date"},null,8,Tt),[[h,o.timestampToDate(s.tempOrder.create_at).formattedDay]])])]),t("div",vt,[yt,t("div",wt,[p(t("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>s.tempOrder.user.email=l),disabled:s.inputDisabled,type:"email",class:"form-control",id:"Email"},null,8,Pt),[[h,s.tempOrder.user.email]])])]),t("div",xt,[Et,t("div",Dt,[p(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>s.tempOrder.user.name=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"name"},null,8,Vt),[[h,s.tempOrder.user.name]])])]),t("div",kt,[At,t("div",Lt,[p(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>s.tempOrder.user.tel=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"tel"},null,8,Ut),[[h,s.tempOrder.user.tel]])])]),t("div",It,[St,t("div",Ct,[p(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>s.tempOrder.user.address=l),disabled:s.inputDisabled,type:"text",class:"form-control",id:"address"},null,8,Mt),[[h,s.tempOrder.user.address]])])]),t("div",Rt,[jt,t("div",Bt,[p(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=l=>s.tempOrder.user.message=l),disabled:s.inputDisabled,class:"form-control",name:"note",id:"note",cols:"10",rows:"10",style:{height:"100px"}},null,8,$t),[[h,s.tempOrder.user.message]])])])])]),t("div",Ht,[qt,t("div",Ft,[t("table",Nt,[zt,t("tbody",null,[(u(!0),_(D,null,V(s.tempOrder.products,l=>(u(),_("tr",{key:l.id},[t("td",Xt,[t("img",{src:l.product.imageUrl,class:"rounded order-img"},null,8,Kt),t("small",null,a(l.product.title),1)]),t("td",Yt,[t("div",Gt,[t("div",Jt,[p(t("input",{"onUpdate:modelValue":c=>l.qty=c,disabled:s.inputDisabled,onClick:e[9]||(e[9]=(...c)=>d.updateTotal&&d.updateTotal(...c)),type:"number",min:"1",class:"form-control"},null,8,Qt),[[h,l.qty]]),t("span",Wt,a(l.product.unit),1)])])]),t("td",Zt,[t("p",te,a(l.product.price)+"元",1)]),t("td",ee,[t("button",{disabled:s.inputDisabled,onClick:e[10]||(e[10]=(...c)=>o.deleteOrder&&o.deleteOrder(...c)),type:"button",class:"btn btn-outline-danger btn-sm py-0",style:{scale:"80%"}}," x ",8,se)])]))),128))]),t("tfoot",null,[t("tr",null,[t("td",null,[t("span",null,a(`總共 ${Object.keys(s.tempOrder.products).length} 項`),1)]),oe,t("td",le,[t("span",{class:O({"fs-6":s.subTotal,"fw-normal":s.subTotal,"text-dark":s.subTotal,"text-decoration-line-through":s.subTotal})},a(s.tempOrder.calculateTotal)+"元 ",3),de,t("span",{class:O({"fs-6":!s.subTotal,"fw-normal":!s.subTotal,"text-dark":!s.subTotal,"text-decoration-line-through":!s.subTotal})},a(s.subTotal)+"元 ",3)]),re])])])])])])])]),t("div",ne,[t("button",{onClick:e[11]||(e[11]=(...l)=>d.cancelUpdateOrder&&d.cancelUpdateOrder(...l)),type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 "),t("button",{onClick:e[12]||(e[12]=(...l)=>d.updateOrder&&d.updateOrder(...l)),type:"button",class:"btn btn-danger"}," 更新訂單 ")])])])])}const ie=E(z,[["render",ae],["__scopeId","data-v-934aa33c"]]);var ce={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"runweiting",VITE_TEXT:"這是部屬完成的環境",BASE_URL:"/create-vue-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_URL:g,VITE_APP_PATH:P}=ce,ue={components:{OrderModal:ie,Pagination:j},data(){return{title:"訂單列表",tempOrderList:[],selectedOrder:{}}},created(){this.tempOrderList=[...this.orderList]},watch:{orderList:{deep:!0,handler(o){this.tempOrderList=o}}},computed:{...C(T,["orderList","pagination","calculateTotal"])},mounted(){this.getOrders()},methods:{...x(T,["getOrders","timestampToDate"]),checkOrder(o){this.selectedOrder={...o},console.log("order",this.selectedOrder),this.$refs.orderModal.orderModal.show()},deleteOrder(o){const e=`${g}/api/${P}/admin/order/${o}`;this.axios.delete(e).then(i=>{b.fire({title:i.data.message,icon:"success",showConfirmButton:!1,timer:1500})}).then(()=>{this.getOrders()})},deleteOrders(){const o=`${g}/api/${P}/admin/orders/all`;this.axios.delete(o).then(e=>{b.fire({title:e.data.message,icon:"success",showConfirmButton:!1,timer:1500}),this.getOrders()})},logout(){const o=`${g}/logout`;this.axios.post(o).then(e=>{b.fire({title:e.data.message,icon:"success",showConfirmButton:!1,timer:1500}).then(()=>{document.cookie="myToken=; expires=;",this.axios.defaults.headers.common.Authorization=null,this.$router.push({name:"login"})})})}}},_e={class:"container"},pe={class:"row py-2"},me={class:"col mt-4 mb-4"},he={class:"container py-2"},be=t("h2",null,"這是訂單頁面",-1),fe={class:"d-flex justify-content-between gap-2 py-2"},ge={class:"p-2 mb-0"},Oe={class:"d-flex justify-content-end gap-2"},Te={class:"container"},ve={class:"table table-hover"},ye=t("thead",{class:"table-dark"},[t("tr",null,[t("th",{scope:"col",class:"fw-bold"},"日期"),t("th",{scope:"col",class:"fw-bold"},"序號"),t("th",{scope:"col",class:"fw-bold"},"訂單編號"),t("th",{scope:"col",class:"fw-bold"},"品項"),t("th",{scope:"col",class:"fw-bold"},"金額"),t("th",{scope:"col",class:"fw-bold"},"訂單狀態"),t("th",{scope:"col",class:"fw-bold"},"付款日期"),t("th")])],-1),we={key:0},Pe=t("td",{colspan:"7"},[t("small",{class:"text-muted"}," 目前沒有任何訂單 ")],-1),xe=[Pe],Ee={class:"d-block"},De={class:"text-muted"},Ve=t("td",null,null,-1),ke={class:"btn-group",role:"group","aria-label":"Basic outlined example"},Ae=["onClick"],Le=["onClick"];function Ue(o,e,i,m,s,d){const l=y("order-modal"),c=y("Pagination");return u(),_("main",_e,[t("div",pe,[t("main",me,[t("div",he,[be,t("div",fe,[t("p",ge,a(`一頁顯示 ${Object.keys(this.tempOrderList).length} 項商品`),1),t("div",Oe,[t("button",{onClick:e[0]||(e[0]=(...r)=>d.deleteOrders&&d.deleteOrders(...r)),type:"button",class:"btn btn-danger"}," 刪除全部訂單 "),t("button",{onClick:e[1]||(e[1]=(...r)=>d.logout&&d.logout(...r)),type:"button",class:"btn btn-warning"}," 登出 ")]),w(l,{ref:"orderModal",currentOrder:s.selectedOrder},null,8,["currentOrder"])])]),t("div",Te,[t("table",ve,[ye,t("tbody",null,[s.tempOrderList?M("",!0):(u(),_("tr",we,xe)),(u(!0),_(D,null,V(s.tempOrderList,r=>(u(),_("tr",{key:r.title},[t("td",null,[t("span",Ee,a(o.timestampToDate(r.create_at).formattedDate),1),t("small",De,a(o.timestampToDate(r.create_at).formattedTime),1)]),t("td",null,a(r.num),1),t("td",null,a(r.id),1),t("td",null,a(Object.keys(r.products).length),1),t("td",null,a(r.calculateTotal),1),t("td",{class:O({"text-success":r.is_paid,"text-danger":!r.is_paid})},a(r.is_paid?"已付款":"未付款"),3),Ve,t("td",null,[t("div",ke,[t("button",{onClick:f=>d.checkOrder(r),type:"button",class:"btn btn-outline-primary btn-sm"}," 查看訂單 ",8,Ae),t("button",{onClick:f=>d.deleteOrder(r.id),type:"button",class:"btn btn-outline-danger btn-sm"}," 刪除 ",8,Le)])])]))),128))])])]),w(c,{pages:o.pagination,onShowPage:o.getOrders},null,8,["pages","onShowPage"])])])])}const Ce=E(ue,[["render",Ue]]);export{Ce as default};
