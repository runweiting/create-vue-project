import{q as V,s as U,u as B,m as _,v as u,_ as f,o as a,c as n,x as I,y as D,a as t,F as P,z as C,t as l,A as m,B as b,r as $,b as y,d as S,C as w,D as E,E as T}from"./index-2ZCpOI4O.js";import{l as L,c as z}from"./cartStore-76TgBEbo.js";import{p as x}from"./productInfoStore-1y-ZyLdR.js";import{C as A}from"./CartList-UdKNOx3E.js";const F=V.useLoading({}),M="https://vue3-course-api.hexschool.io/v2",j="runweiting",h=U("productsStore",{state:()=>({productList:[],pagination:{},fullPage:!1}),actions:{async getProducts(s,e=1){const d=F.show();let c=`${M}/api/${j}/products?page=${e}`;s&&(c+=`&category=${s}`);try{const i=await B.get(c),{products:p,pagination:o}=i.data;this.productList=p,this.pagination=o,this.sortProducts()}finally{d.hide()}},sortProducts(){this.productList=this.productList.sort((s,e)=>s.price-e.price)}}}),q="https://vue3-course-api.hexschool.io/v2",G="runweiting",v=U("categoryStore",{state:()=>({categoryList:[]}),actions:{getCategory(){const s=`${q}/api/${G}/products/all`;B.get(s).then(e=>{const{products:d}=e.data,c=new Set(d.map(i=>i.category));this.categoryList=[...c]})}}}),Q={data(){return{currentCategory:""}},watch:{currentCategory(){this.getProducts(1,this.currentCategory)}},computed:{..._(v,["categoryList"])},methods:{...u(h,["getProducts"])}},H=t("option",{value:""},"全部",-1),J=["value"];function K(s,e,d,c,i,p){return a(),n("div",null,[I(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>i.currentCategory=o),class:"form-select form-select-sm"},[H,(a(!0),n(P,null,C(s.categoryList,o=>(a(),n("option",{key:o,value:o},l(o),9,J))),128))],512),[[D,i.currentCategory]])])}const O=f(Q,[["render",K]]),R={computed:{..._(h,["pagination"])},methods:{...u(h,["getProducts"])}},W={class:"px-2"},X={"aria-label":"Page navigation example"},Y={class:"pagination"},Z=t("span",{"aria-hidden":"true"},"«",-1),tt=[Z],st={key:0,class:"page-link"},ot=["onClick"],et=t("span",{"aria-hidden":"true"},"»",-1),at=[et];function nt(s,e,d,c,i,p){return a(),n("div",W,[t("nav",X,[t("ul",Y,[t("li",{class:m([{disabled:s.pagination.current_page===1},"page-item"])},[t("a",{onClick:e[0]||(e[0]=b(o=>s.getProducts(s.pagination.current_page-1),["prevent"])),class:"page-link",href:"#","aria-label":"Previous"},tt)],2),(a(!0),n(P,null,C(s.pagination.total_pages,(o,g)=>(a(),n("li",{key:g,class:m([{active:o===s.pagination.current_page},"page-item"])},[o===s.pagination.current_page?(a(),n("span",st,l(o),1)):(a(),n("a",{key:1,onClick:b(r=>s.getProducts(o),["prevent"]),class:"page-link",href:"#"},l(o),9,ot))],2))),128)),t("li",{class:m([{disabled:s.pagination.current_page===s.pagination.total_pages},"page-item"])},[t("a",{onClick:e[1]||(e[1]=b(o=>s.getProducts(s.pagination.current_page+1),["prevent"])),class:"page-link",href:"#","aria-label":"Next"},at)],2)])])])}const rt=f(R,[["render",nt]]),it={components:{CategoryList:O,PaginationGroup:rt},data(){return{apiUrl:"https://vue3-course-api.hexschool.io/v2",apiPath:"runweiting",title:"商品列表",product:{},fullPage:!1}},mounted(){this.getProducts(),this.getCategory()},computed:{..._(h,["productList"]),..._(v,["categoryList"]),..._(L,["loadingStatus"])},methods:{...u(h,["getProducts"]),...u(z,["addToCart"]),...u(v,["getCategory"]),...u(x,["setSelectedProduct"]),async getProduct(s){const e=L();e.loadingStatus.getProduct=s;const d=`${this.apiUrl}/api/${this.apiPath}/product/${s}`;this.$route.params.id=s;try{const c=await this.axios.get(d);this.product=c.data.product,x().setSelectedProduct(this.product),e.loadingStatus.getProduct=""}finally{this.$router.push({name:"productInfo"})}}}},k=s=>(E("data-v-c446b7e5"),s=s(),T(),s),ct={class:"col-8 mt-4 mb-4",ref:"productList"},dt={class:"container d-flex justify-content-between"},lt={class:"p-2 mb-0"},pt={class:"container table-responsive"},ut={class:"table table-hover align-middle"},gt={class:"table-secondary"},_t={class:"align-middle",style:{height:"48px"}},ht={scope:"col",style:{width:"17%"}},$t=k(()=>t("th",{scope:"col",class:"fw-bold",style:{width:"30%"}},"商品名稱",-1)),yt=k(()=>t("th",{scope:"col",class:"fw-bold",style:{width:"28%"}},"價格",-1)),ft=k(()=>t("th",{scope:"col",style:{width:"25%"}},null,-1)),mt=["src"],bt={key:0,class:"fs-5 fw-bold mb-0"},vt={key:1},Pt={class:"fs-6 fw-bold text-secondary"},Ct={class:"fs-5 fw-bold mb-0"},kt={class:"d-flex flex-column gap-2"},St=["disabled","onClick"],wt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Lt=["onClick"],xt={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Ut(s,e,d,c,i,p){const o=$("category-list"),g=$("pagination-group");return a(),n("div",ct,[t("div",dt,[t("h2",null,l(i.title),1),t("p",lt,l(`目前有 ${s.productList.length} 項商品`),1)]),t("div",pt,[t("table",ut,[t("thead",gt,[t("tr",_t,[t("th",ht,[y(o)]),$t,yt,ft])]),t("tbody",null,[(a(!0),n(P,null,C(s.productList,r=>(a(),n("tr",{key:r.title},[t("td",null,[t("img",{src:r.imageUrl,class:"rounded product-img"},null,8,mt)]),t("td",null,l(r.title),1),t("td",null,[r.origin_price===r.price?(a(),n("p",bt,l(r.price)+"元 ",1)):(a(),n("div",vt,[t("del",Pt,"原價"+l(r.origin_price)+"元",1),t("p",Ct,"現在只要"+l(r.price)+"元",1)]))]),t("td",null,[t("div",kt,[t("button",{disabled:r.id===this.loadingStatus.getProduct,onClick:N=>p.getProduct(r.id),type:"button",class:"btn btn-outline-secondary",id:"modalBtn"},[S(" 查看更多 "),r.id===this.loadingStatus.getProduct?(a(),n("span",wt)):w("",!0)],8,St),t("button",{onClick:N=>s.addToCart(r.id),type:"button",class:"btn btn-outline-danger"},[S(" 加入購物車 "),r.id===this.loadingStatus.updateQty?(a(),n("span",xt)):w("",!0)],8,Lt)])])]))),128))])]),y(g)])],512)}const Bt=f(it,[["render",Ut],["__scopeId","data-v-c446b7e5"]]),Nt={components:{ProductList:Bt,CartList:A}},Vt={class:"container"},It=t("h1",{class:"pt-5 text-center"},"商品列表",-1),Dt={class:"row py-2"};function Et(s,e,d,c,i,p){const o=$("product-list"),g=$("cart-list");return a(),n("main",Vt,[It,t("div",Dt,[y(o),y(g)])])}const Mt=f(Nt,[["render",Et]]);export{Mt as default};
